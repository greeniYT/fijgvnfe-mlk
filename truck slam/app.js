var Elements,Utils,__extends=this&&this.__extends||function(){var e=function(t,a){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)t.hasOwnProperty(a)&&(e[a]=t[a])},e(t,a)};return function(t,a){function i(){this.constructor=t}e(t,a),t.prototype=null===a?Object.create(a):(i.prototype=a.prototype,new i)}}();!function(e){var t=function(){function e(e,t,a,i,s,r){void 0===r&&(r=!0),this.oAssetData={},this.assetsLoaded=0,this.textData={},this.spinnerRot=0,this.offsetY=100,this.totalAssets=t.length,this.showBar=r;for(var o=0;o<t.length;o++)-1!=t[o].file.indexOf(".json")?this.loadJSON(t[o]):this.loadImage(t[o]);r&&(this.oLoaderImgData=preAssetLib.getData("loader"),this.oLoadSpinnerImgData=preAssetLib.getData("loadSpinner"))}return e.prototype.render=function(){ctx.fillStyle="#013B7B",ctx.fillRect(0,0,canvas.width,canvas.height),ctx.fillStyle="#FFFFFF",ctx.fillRect(canvas.width/2-150,canvas.height/2+20+this.offsetY,300/this.totalAssets*this.assetsLoaded,30),ctx.drawImage(this.oLoaderImgData.img,canvas.width/2-this.oLoaderImgData.img.width/2,canvas.height/2-this.oLoaderImgData.img.height/2),this.spinnerRot+=3*delta,ctx.save(),ctx.translate(canvas.width/2-30,canvas.height/2-16+this.offsetY),ctx.rotate(this.spinnerRot),ctx.drawImage(this.oLoadSpinnerImgData.img,-this.oLoadSpinnerImgData.img.width/2,-this.oLoadSpinnerImgData.img.height/2),ctx.restore(),this.displayNumbers()},e.prototype.displayNumbers=function(){ctx.textAlign="left",ctx.font="bold 40px arial",ctx.fillStyle="#ffffff",ctx.fillText(Math.round(this.assetsLoaded/this.totalAssets*100)+"%",canvas.width/2+0,canvas.height/2-1+this.offsetY)},e.prototype.loadExtraAssets=function(e,t){this.showBar=!1,this.totalAssets=t.length,this.assetsLoaded=0,this.loadedCallback=e;for(var a=0;a<t.length;a++)-1!=t[a].file.indexOf(".json")?this.loadJSON(t[a]):this.loadImage(t[a])},e.prototype.loadJSON=function(e){var t=this,a=new XMLHttpRequest;a.open("GET",e.file,!0),a.onreadystatechange=function(){4==a.readyState&&200==a.status&&(t.textData[e.id]=JSON.parse(a.responseText),++t.assetsLoaded,t.checkLoadComplete())},a.send(null)},e.prototype.loadImage=function(e){var t=this,a=new Image;a.onload=function(){t.oAssetData[e.id]={},t.oAssetData[e.id].img=a,t.oAssetData[e.id].oData={};var i=t.getSpriteSize(e.file);0!=i[0]?(t.oAssetData[e.id].oData.spriteWidth=i[0],t.oAssetData[e.id].oData.spriteHeight=i[1]):(t.oAssetData[e.id].oData.spriteWidth=t.oAssetData[e.id].img.width,t.oAssetData[e.id].oData.spriteHeight=t.oAssetData[e.id].img.height),e.oAnims&&(t.oAssetData[e.id].oData.oAnims=e.oAnims),e.oAtlasData?t.oAssetData[e.id].oData.oAtlasData=e.oAtlasData:t.oAssetData[e.id].oData.oAtlasData={none:{x:0,y:0,width:t.oAssetData[e.id].oData.spriteWidth,height:t.oAssetData[e.id].oData.spriteHeight}},++t.assetsLoaded,t.checkLoadComplete()},a.src=e.file},e.prototype.getSpriteSize=function(e){for(var t=new Array,a="",i="",s=0,r=e.lastIndexOf("."),o=!0;o;)r--,0==s&&this.isNumber(e.charAt(r))?a=e.charAt(r)+a:0==s&&a.length>0&&"x"==e.charAt(r)?(r--,s=1,i=e.charAt(r)+i):1==s&&this.isNumber(e.charAt(r))?i=e.charAt(r)+i:1==s&&i.length>0&&"_"==e.charAt(r)?(o=!1,t=[parseInt(i),parseInt(a)]):(o=!1,t=[0,0]);return t},e.prototype.isNumber=function(e){return!isNaN(parseFloat(e))&&isFinite(e)},e.prototype.checkLoadComplete=function(){this.assetsLoaded==this.totalAssets&&this.loadedCallback()},e.prototype.onReady=function(e){this.loadedCallback=e},e.prototype.getImg=function(e){return this.oAssetData[e].img},e.prototype.getData=function(e){return this.oAssetData[e]},e}();e.AssetLoader=t}(Utils||(Utils={})),function(e){var t=function(){function e(e,t,a,i,s){void 0===s&&(s=!0),this.x=0,this.y=0,this.rotation=0,this.radius=10,this.removeMe=!1,this.frameInc=0,this.animType="loop",this.offsetX=0,this.offsetY=0,this.scaleX=1,this.scaleY=1,this.alpha=1,this.frameBuffer=0,this.oImgData=e,this.oAnims=this.oImgData.oData.oAnims,this.fps=t,this.radius=a,this.animId=i,this.frameBuffer=s?2:0,this.centreX=Math.round(this.oImgData.oData.spriteWidth/2),this.centreY=Math.round(this.oImgData.oData.spriteHeight/2)}return e.prototype.updateAnimation=function(){this.frameInc+=this.fps*delta},e.prototype.changeImgData=function(e,t){this.oImgData=e,this.oAnims=this.oImgData.oData.oAnims,this.animId=t,this.centreX=Math.round(this.oImgData.oData.spriteWidth/2),this.centreY=Math.round(this.oImgData.oData.spriteHeight/2),this.resetAnim()},e.prototype.resetAnim=function(){this.frameInc=0},e.prototype.setFrame=function(e){this.fixedFrame=e},e.prototype.setAnimType=function(e,t,a){switch(void 0===a&&(a=!0),this.animId=t,this.animType=e,a&&this.resetAnim(),e){case"loop":break;case"once":this.maxIdx=this.oAnims[this.animId].length-1}},e.prototype.render=function(){if(ctx.save(),ctx.translate(this.x,this.y),ctx.rotate(this.rotation),ctx.scale(this.scaleX,this.scaleY),ctx.globalAlpha=this.alpha,null!=this.animId){var e=this.oAnims[this.animId].length,t=Math.floor(this.frameInc);this.curFrame=this.oAnims[this.animId][t%e];var a=this.curFrame*this.oImgData.oData.spriteWidth%this.oImgData.img.width,i=Math.floor(this.curFrame/(this.oImgData.img.width/this.oImgData.oData.spriteWidth))*this.oImgData.oData.spriteHeight;if("once"==this.animType&&t>this.maxIdx){this.fixedFrame=this.oAnims[this.animId][e-1],this.animId=null,null!=this.animEndedFunc&&this.animEndedFunc();a=this.fixedFrame*this.oImgData.oData.spriteWidth%this.oImgData.img.width,i=Math.floor(this.fixedFrame/(this.oImgData.img.width/this.oImgData.oData.spriteWidth))*this.oImgData.oData.spriteHeight}}else a=this.fixedFrame*this.oImgData.oData.spriteWidth%this.oImgData.img.width,i=Math.floor(this.fixedFrame/(this.oImgData.img.width/this.oImgData.oData.spriteWidth))*this.oImgData.oData.spriteHeight;ctx.drawImage(this.oImgData.img,a,i,this.oImgData.oData.spriteWidth,this.oImgData.oData.spriteHeight,-this.centreX+this.offsetX,-this.centreY+this.offsetY,this.oImgData.oData.spriteWidth,this.oImgData.oData.spriteHeight),ctx.restore()},e.prototype.renderSimple=function(){if(null!=this.animId){var e=this.oAnims[this.animId].length,t=Math.floor(this.frameInc);this.curFrame=this.oAnims[this.animId][t%e];var a=this.curFrame*(this.oImgData.oData.spriteWidth+this.frameBuffer)%this.oImgData.img.width,i=Math.floor(this.curFrame/(this.oImgData.img.width/(this.oImgData.oData.spriteWidth+this.frameBuffer)))*(this.oImgData.oData.spriteHeight+this.frameBuffer);if("once"==this.animType&&t>this.maxIdx){this.fixedFrame=this.oAnims[this.animId][e-1],this.animId=null,null!=this.animEndedFunc&&this.animEndedFunc();a=this.fixedFrame*(this.oImgData.oData.spriteWidth+this.frameBuffer)%this.oImgData.img.width,i=Math.floor(this.fixedFrame/(this.oImgData.img.width/(this.oImgData.oData.spriteWidth+this.frameBuffer)))*(this.oImgData.oData.spriteHeight+this.frameBuffer)}}else a=this.fixedFrame*(this.oImgData.oData.spriteWidth+this.frameBuffer)%this.oImgData.img.width,i=Math.floor(this.fixedFrame/(this.oImgData.img.width/(this.oImgData.oData.spriteWidth+this.frameBuffer)))*(this.oImgData.oData.spriteHeight+this.frameBuffer);ctx.drawImage(this.oImgData.img,a,i,this.oImgData.oData.spriteWidth,this.oImgData.oData.spriteHeight,this.x-(this.centreX-this.offsetX)*this.scaleX,this.y-(this.centreY-this.offsetY)*this.scaleY,this.oImgData.oData.spriteWidth*this.scaleX,this.oImgData.oData.spriteHeight*this.scaleY)},e}();e.AnimSprite=t}(Utils||(Utils={})),function(e){var t=function(){function e(e,t,a){void 0===a&&(a=0),this.x=0,this.y=0,this.rotation=0,this.radius=10,this.removeMe=!1,this.offsetX=0,this.offsetY=0,this.scaleX=1,this.scaleY=1,this.oImgData=e,this.radius=t,this.setFrame(a)}return e.prototype.setFrame=function(e){this.frameNum=e},e.prototype.render=function(e){e.save(),e.translate(this.x,this.y),e.rotate(this.rotation),e.scale(this.scaleX,this.scaleY);var t=this.frameNum*this.oImgData.oData.spriteWidth%this.oImgData.img.width,a=Math.floor(this.frameNum/(this.oImgData.img.width/this.oImgData.oData.spriteWidth))*this.oImgData.oData.spriteHeight;e.drawImage(this.oImgData.img,t,a,this.oImgData.oData.spriteWidth,this.oImgData.oData.spriteHeight,-this.oImgData.oData.spriteWidth/2+this.offsetX,-this.oImgData.oData.spriteHeight/2+this.offsetY,this.oImgData.oData.spriteWidth,this.oImgData.oData.spriteHeight),e.restore()},e}();e.BasicSprite=t}(Utils||(Utils={})),function(e){var t=function(){function e(e,t){var a=this;this.prevHitTime=0,this.pauseIsOn=!1,this.isDown=!1,this.isBugBrowser=t,this.keyDownEvtFunc=function(e){a.keyDown(e)},this.keyUpEvtFunc=function(e){a.keyUp(e)},e.addEventListener("contextmenu",(function(e){return e.preventDefault()})),e.addEventListener("touchstart",(function(e){for(var t=0;t<e.changedTouches.length;t++)a.hitDown(e,e.changedTouches[t].pageX,e.changedTouches[t].pageY,e.changedTouches[t].identifier)}),!1),e.addEventListener("touchend",(function(e){for(var t=0;t<e.changedTouches.length;t++)a.hitUp(e,e.changedTouches[t].pageX,e.changedTouches[t].pageY,e.changedTouches[t].identifier)}),!1),e.addEventListener("touchcancel",(function(e){for(var t=0;t<e.changedTouches.length;t++)a.hitCancel(e,e.changedTouches[t].pageX,e.changedTouches[t].pageY,e.changedTouches[t].identifier)}),!1),e.addEventListener("touchmove",(function(e){for(var t=0;t<e.changedTouches.length;t++)a.move(e,e.changedTouches[t].pageX,e.changedTouches[t].pageY,e.changedTouches[t].identifier,!0)}),!1),e.addEventListener("mousedown",(function(e){a.isDown=!0,a.hitDown(e,e.pageX,e.pageY,1)}),!1),e.addEventListener("mouseup",(function(e){a.isDown=!1,a.hitUp(e,e.pageX,e.pageY,1)}),!1),e.addEventListener("mousemove",(function(e){a.move(e,e.pageX,e.pageY,1,a.isDown)}),!1),e.addEventListener("mouseout",(function(e){2!=e.button&&(clearButtonOvers(),a.isDown=!1,a.hitCancel(e,Math.abs(e.pageX),Math.abs(e.pageY),1))}),!1),this.aHitAreas=new Array,this.aKeys=new Array}return e.prototype.hitDown=function(e,t,a,i){if(e.preventDefault(),e.stopPropagation(),hasFocus||visibleResume(),!this.pauseIsOn){var s=(new Date).getTime();t*=canvasScale,a*=canvasScale;for(var r=0;r<this.aHitAreas.length;r++)if(this.aHitAreas[r].rect){var o=canvas.width*this.aHitAreas[r].align[0],n=canvas.height*this.aHitAreas[r].align[1];if(t>o+this.aHitAreas[r].area[0]&&a>n+this.aHitAreas[r].area[1]&&t<o+this.aHitAreas[r].area[2]&&a<n+this.aHitAreas[r].area[3]){if(this.aHitAreas[r].aTouchIdentifiers.push(i),this.aHitAreas[r].oData.hasLeft=!1,this.aHitAreas[r].oData.isUp=!1,this.aHitAreas[r].oData.isDown=!0,this.aHitAreas[r].oData.x=t,this.aHitAreas[r].oData.y=a,this.aHitAreas[r].oData.button=e.button,s-this.prevHitTime<500&&("game"!=gameState||"pause"==this.aHitAreas[r].id)&&isBugBrowser)return;this.aHitAreas[r].callback(this.aHitAreas[r].id,this.aHitAreas[r].oData);break}}this.prevHitTime=s}},e.prototype.hitUp=function(e,t,a,i){if(ios9FirstTouch||(playSound("silence"),ios9FirstTouch=!0),!this.pauseIsOn){e.preventDefault(),e.stopPropagation(),t*=canvasScale,a*=canvasScale;for(var s=0;s<this.aHitAreas.length;s++)if(this.aHitAreas[s].rect){var r=canvas.width*this.aHitAreas[s].align[0],o=canvas.height*this.aHitAreas[s].align[1];if(t>r+this.aHitAreas[s].area[0]&&a>o+this.aHitAreas[s].area[1]&&t<r+this.aHitAreas[s].area[2]&&a<o+this.aHitAreas[s].area[3]){for(var n=0;n<this.aHitAreas[s].aTouchIdentifiers.length;n++)this.aHitAreas[s].aTouchIdentifiers[n]==i&&(this.aHitAreas[s].oData.identifier=i,this.aHitAreas[s].aTouchIdentifiers.splice(n,1),n-=1);0==this.aHitAreas[s].aTouchIdentifiers.length&&(this.aHitAreas[s].oData.isDown=!1),this.aHitAreas[s].oData.isUp=!0,this.aHitAreas[s].oData.multiTouch&&(this.aHitAreas[s].oData.x=t,this.aHitAreas[s].oData.y=a,this.aHitAreas[s].oData.button=e.button,this.aHitAreas[s].callback(this.aHitAreas[s].id,this.aHitAreas[s].oData));break}}}},e.prototype.hitCancel=function(e,t,a,i){e.preventDefault(),e.stopPropagation(),t*=canvasScale,a*=canvasScale;for(var s=0;s<this.aHitAreas.length;s++)this.aHitAreas[s].oData.isDown&&(this.aHitAreas[s].oData.isDown=!1,this.aHitAreas[s].aTouchIdentifiers=new Array,this.aHitAreas[s].oData.multiTouch&&(this.aHitAreas[s].oData.x=t,this.aHitAreas[s].oData.y=a,this.aHitAreas[s].callback(this.aHitAreas[s].id,this.aHitAreas[s].oData)))},e.prototype.move=function(e,t,a,i,s){if(!this.pauseIsOn&&(t*=canvasScale,a*=canvasScale,this.mouseX=t,this.mouseY=a,s))for(var r=0;r<this.aHitAreas.length;r++)if(this.aHitAreas[r].rect){var o=canvas.width*this.aHitAreas[r].align[0],n=canvas.height*this.aHitAreas[r].align[1];if(t>o+this.aHitAreas[r].area[0]&&a>n+this.aHitAreas[r].area[1]&&t<o+this.aHitAreas[r].area[2]&&a<n+this.aHitAreas[r].area[3])this.aHitAreas[r].oData.hasLeft=!1,this.aHitAreas[r].oData.isDraggable&&!this.aHitAreas[r].oData.isDown&&(this.aHitAreas[r].oData.isDown=!0,this.aHitAreas[r].oData.isBeingDragged=!0,this.aHitAreas[r].oData.x=t,this.aHitAreas[r].oData.y=a,this.aHitAreas[r].aTouchIdentifiers.push(i),this.aHitAreas[r].oData.multiTouch&&this.aHitAreas[r].callback(this.aHitAreas[r].id,this.aHitAreas[r].oData)),this.aHitAreas[r].oData.isDraggable&&(this.aHitAreas[r].oData.isBeingDragged=!0,this.aHitAreas[r].oData.x=t,this.aHitAreas[r].oData.y=a,this.aHitAreas[r].callback(this.aHitAreas[r].id,this.aHitAreas[r].oData));else if(this.aHitAreas[r].oData.isDown&&!this.aHitAreas[r].oData.hasLeft){for(var h=0;h<this.aHitAreas[r].aTouchIdentifiers.length;h++)this.aHitAreas[r].aTouchIdentifiers[h]==i&&(this.aHitAreas[r].aTouchIdentifiers.splice(h,1),h-=1);0==this.aHitAreas[r].aTouchIdentifiers.length&&(this.aHitAreas[r].oData.hasLeft=!0,this.aHitAreas[r].oData.isBeingDragged||(this.aHitAreas[r].oData.isDown=!1),this.aHitAreas[r].oData.multiTouch&&this.aHitAreas[r].callback(this.aHitAreas[r].id,this.aHitAreas[r].oData))}}},e.prototype.keyDown=function(e){for(var t=0;t<this.aKeys.length;t++)e.keyCode==this.aKeys[t].keyCode&&(e.preventDefault(),this.aKeys[t].oData.isDown=!0,this.aKeys[t].callback(this.aKeys[t].id,this.aKeys[t].oData))},e.prototype.keyUp=function(e){for(var t=0;t<this.aKeys.length;t++)e.keyCode==this.aKeys[t].keyCode&&(e.preventDefault(),this.aKeys[t].oData.isDown=!1,this.aKeys[t].callback(this.aKeys[t].id,this.aKeys[t].oData))},e.prototype.checkKeyFocus=function(){window.focus(),this.aKeys.length>0&&(window.removeEventListener("keydown",this.keyDownEvtFunc,!1),window.removeEventListener("keyup",this.keyUpEvtFunc,!1),window.addEventListener("keydown",this.keyDownEvtFunc,!1),window.addEventListener("keyup",this.keyUpEvtFunc,!1))},e.prototype.addKey=function(e,t,a,i){null==a&&(a=new Object),this.aKeys.push({id:e,callback:t,oData:a,keyCode:i}),this.checkKeyFocus()},e.prototype.removeKey=function(e){for(var t=0;t<this.aKeys.length;t++)this.aKeys[t].id==e&&(this.aKeys.splice(t,1),t-=1)},e.prototype.addHitArea=function(e,t,a,i,s,r){void 0===r&&(r=!1),null==a&&(a=new Object),r&&this.removeHitArea(e),s.scale||(s.scale=1),s.align||(s.align=[0,0]);var o=new Array;switch(i){case"image":var n;n=new Array(s.aPos[0]-s.oImgData.oData.oAtlasData[s.id].width/2*s.scale,s.aPos[1]-s.oImgData.oData.oAtlasData[s.id].height/2*s.scale,s.aPos[0]+s.oImgData.oData.oAtlasData[s.id].width/2*s.scale,s.aPos[1]+s.oImgData.oData.oAtlasData[s.id].height/2*s.scale),this.aHitAreas.push({id:e,aTouchIdentifiers:o,callback:t,oData:a,rect:!0,area:n,align:s.align});break;case"rect":this.aHitAreas.push({id:e,aTouchIdentifiers:o,callback:t,oData:a,rect:!0,area:s.aRect,align:s.align})}},e.prototype.removeHitArea=function(e){for(var t=0;t<this.aHitAreas.length;t++)this.aHitAreas[t].id==e&&(this.aHitAreas.splice(t,1),t-=1)},e.prototype.resetAll=function(){for(var e=0;e<this.aHitAreas.length;e++)this.aHitAreas[e].oData.isDown=!1,this.aHitAreas[e].oData.isBeingDragged=!1,this.aHitAreas[e].aTouchIdentifiers=new Array;this.isDown=!1},e}();e.UserInput=t}(Utils||(Utils={})),function(e){var t=function(){function e(e){this.updateFreq=10,this.updateInc=0,this.frameAverage=0,this.display=1,this.log="",this.render=function(e){this.frameAverage+=this.delta/this.updateFreq,++this.updateInc>=this.updateFreq&&(this.updateInc=0,this.display=this.frameAverage,this.frameAverage=0),e.textAlign="left",ctx.font="10px Helvetica",e.fillStyle="#333333",e.beginPath(),e.rect(0,this.canvasHeight-15,40,15),e.closePath(),e.fill(),e.fillStyle="#ffffff",e.fillText(Math.round(1e3/(1e3*this.display))+" fps "+this.log,5,this.canvasHeight-5)},this.canvasHeight=e}return e.prototype.update=function(e){this.delta=e},e}();e.FpsMeter=t}(Utils||(Utils={})),function(e){var t=function(){function e(){this.oImgData=hasGravity?assetLib.getData("bg"+curLevel%5):assetLib.getData("bg5")}return e.prototype.render=function(){canvas.width>canvas.height?ctx.drawImage(this.oImgData.img,0,(1-canvas.height/canvas.width)/2*this.oImgData.img.height,this.oImgData.img.width,canvas.height/canvas.width*this.oImgData.img.height,0,0,canvas.width,canvas.height):ctx.drawImage(this.oImgData.img,(1-canvas.width/canvas.height)/2*this.oImgData.img.width,0,canvas.width/canvas.height*this.oImgData.img.width,this.oImgData.img.width,0,0,canvas.width,canvas.height)},e}();e.Background=t}(Elements||(Elements={})),function(e){var t=function(){function t(e,t){this.timer=.3,this.endTime=0,this.posY=0,this.numberSpace=17,this.incY=0,this.flareRot=0,this.levelCompleteInc=1,this.butDisplayState=0,this.tutInc=1,this.tutId=0,this.curFps=0,this.fpsInc=.5,this.tutDelayInc=0,this.upgradeCogTarg=0,this.upgradeCogInc=0,this.upgradeBarState=0,this.upgradeBarJiggle=0,this.upgradeBarId=0,this.oSplashLogoImgData=assetLib.getData("splashLogo"),this.oUiElementsImgData=assetLib.getData("uiElements"),this.panelType=e,this.aButs=t,this.oTopFlareImgData=assetLib.getData("flare")}return t.prototype.update=function(){this.incY+=10*delta},t.prototype.startTween1=function(){this.posY=500,TweenLite.to(this,.5,{posY:0,ease:"Back.easeOut"}),this.butsY=500,TweenLite.to(this,.5,{butsY:0,ease:"Cubic.easeOut"})},t.prototype.tweenTut=function(){var e=this;this.tutTween&&this.tutTween.kill(),this.tutInc=1,this.tutTween=TweenLite.to(this,.5,{tutInc:0,ease:"Back.easeOut",onComplete:function(){1==gameMode&&(e.tutTween=TweenLite.to(e,.5,{tutInc:1,delay:4,ease:"Back.easeIn",onComplete:function(){}}))}})},t.prototype.tweenMultiplayerLeveEnd=function(){var e=this;this.levelCompleteTween&&this.levelCompleteTween.kill(),setTimeout((function(){playSound("gemTweenOut")}),100),this.levelCompleteInc=1,this.levelCompleteTween=TweenLite.to(this,.5,{levelCompleteInc:0,ease:"Cubic.easeOut",onComplete:function(){e.levelCompleteTween=TweenLite.to(e,.25,{levelCompleteInc:1,delay:.75,ease:"Cubic.easeIn",onComplete:function(){++curLevel>=aRawLevelData.length&&(curLevel=p2LevelIndexStart),saveDataHandler.setP2Level(curLevel-p2LevelIndexStart),showAd((function(){generateLevel(),startGameplay()}))}})}})},t.prototype.tweenLevelSuccess=function(){var e=this;this.levelCompleteTween&&this.levelCompleteTween.kill(),this.butDisplayState=0,this.levelCompleteInc=1,this.levelCompleteTween=TweenLite.to(this,.5,{levelCompleteInc:0,ease:"Cubic.easeOut",onComplete:function(){saveDataHandler.upgradesLeft()?(e.upgradeBarState=1,e.upgradeCogTarg=upgradeCogCount+curCogs,e.upgradeCogInc=.5):setTimeout((function(){showAd((function(){initNextP1Level()}))}),1e3)}}),this.aWinGems=new Array,0==gameMode&&(this.winGemTarg=getCoinWin()),setTimeout((function(){playSound("gemTweenOut")}),100),this.winGemCount=this.winGemTarg+20},t.prototype.switchBut=function(e,t,a,i,s){void 0===i&&(i=null),void 0===s&&(s=null);for(var r=null,o=0;o<this.aButs.length;o++)this.aButs[o].id==e&&(this.aButs[o].id=t,this.aButs[o].idOver=a,r=this.aButs[o],i&&(this.aButs[o].aPos=i),s&&(this.aButs[o].align=s));return r},t.prototype.removeBut=function(e){for(var t=0;t<this.aButs.length;t++)this.aButs[t].id==e&&(this.aButs.splice(t,1),t-=1)},t.prototype.render=function(t){switch(void 0===t&&(t=!0),t||this.addButs(ctx),gameState){case"splash":ctx.fillStyle="rgba(0, 0, 0, 0.35)",ctx.fillRect(0,0,canvas.width,canvas.height),ctx.drawImage(this.oSplashLogoImgData.img,canvas.width/2-this.oSplashLogoImgData.img.width/2,canvas.height/2-this.oSplashLogoImgData.img.height/2-this.posY);break;case"start":ctx.fillStyle="rgba(0, 0, 0, 0.25)",ctx.fillRect(0,0,canvas.width,canvas.height),this.flareRot+=delta/3,ctx.save(),ctx.translate(canvas.width/2,.33*canvas.height-this.posY),ctx.rotate(this.flareRot),ctx.scale(2,2),ctx.drawImage(this.oTopFlareImgData.img,-this.oTopFlareImgData.img.width/2,-this.oTopFlareImgData.img.height/2),ctx.restore();var a=getSpriteData(assetLib.getData("uiElements"),"logo");ctx.drawImage(a.img,a.bX,a.bY,a.bWidth,a.bHeight,canvas.width/2-a.bWidth/2+10*Math.sin(this.incY),.35*canvas.height-a.bHeight/2-this.posY,a.bWidth,a.bHeight),Math.sin(1*this.incY)>0&&addText(0,75,canvas.width/2,"center",canvas.width/2,.7*canvas.height+220+this.butsY,"play","#FFFFFF"),addText(0,40,canvas.width/2,"center",100,canvas.height-28+this.butsY,"p2","#FFFFFF");break;case"credits":ctx.fillStyle="rgba(0, 0, 0, 0.35)",ctx.fillRect(0,0,canvas.width,canvas.height),ctx.drawImage(this.oSplashLogoImgData.img,canvas.width/2-this.oSplashLogoImgData.img.width/2,canvas.height/2-this.oSplashLogoImgData.img.height/2-this.posY),addText(0,35,canvas.width-110,"right",canvas.width-110,canvas.height-15+this.butsY,"reset","#ffffff"),addDirectText(0,25,canvas.width,"center",canvas.width/2,canvas.height-15,"v0.3.2","#aaaaaa");break;case"resetConfirm":ctx.fillStyle="rgba(0, 0, 0, 0.65)",ctx.fillRect(0,0,canvas.width,canvas.height),addText(0,60,canvas.width-100,"center",canvas.width/2,canvas.height/2-100+this.butsY,"resetConfirm0","#FFFFFF"),addText(0,40,canvas.width-100,"center",canvas.width/2,canvas.height/2-40+this.butsY,"resetConfirm1","#FCEA02");break;case"levelFail":a=getSpriteData(assetLib.getData("uiElements"),"levelShield1");if(ctx.drawImage(a.img,a.bX,a.bY,a.bWidth,a.bHeight,canvas.width/2-a.bWidth/2,.38*canvas.height-a.bHeight/2-this.posY+10*Math.sin(.3*this.incY),a.bWidth,a.bHeight),Math.random()>.5){var i=new e.ParticleLine(canvas.width/2,.38*canvas.height,1*Math.random()+1,300,360*Math.random()*radian,20,1,200);aUnderEffects.push(i)}this.renderBottomUI(),Math.sin(this.incY)>0&&addText(0,77,canvas.width-100,"center",canvas.width/2,.7*canvas.height+225+this.butsY,"retry","#FFFFFF");break;case"upgradeScreen":var s,r;ctx.fillStyle="rgba(0, 0, 0, 0.5)",ctx.fillRect(0,0,canvas.width,canvas.height),this.flareRot+=delta/3,ctx.save(),ctx.translate(canvas.width/2,.55*canvas.height+10*Math.sin(.3*this.incY)+this.butsY),ctx.rotate(this.flareRot),ctx.scale(2,2),ctx.drawImage(this.oTopFlareImgData.img,-this.oTopFlareImgData.img.width/2,-this.oTopFlareImgData.img.height/2),ctx.restore(),addText(0,80,canvas.width-100,"center",canvas.width/2,.55*canvas.height-330+this.butsY,"upgrade","#FFFFFF"),this.addButs(ctx),t=!1;for(var o=0;o<aUpgradeOffer.length;o++)if(4==aUpgradeOffer.length||3==aUpgradeOffer.length&&o<2?(s=canvas.width/2-160+o%2*320,d=.55*canvas.height-140+280*Math.floor(o/2)+this.butsY):3==aUpgradeOffer.length?(s=canvas.width/2,d=.55*canvas.height-140+280*Math.floor(o/2)+this.butsY):1==aUpgradeOffer.length&&(s=canvas.width/2,d=.55*canvas.height+this.butsY),aUpgradeOffer[o]<4){addDirectText(0,45,270,"center",s,d-70,getText("upgradeTitle"+aUpgradeOffer[o],0)+" +"+aUpgrades[aUpgradeOffer[o]].perc*(saveDataHandler["getUpgrade"+aUpgradeOffer[o]]()+1)+"%","#333333"),this.renderUpgradeIcon(aUpgradeOffer[o],0,s-82,d),this.renderUpgradeIcon(aUpgradeOffer[o],1,s+82,d);for(var n=0;n<10;n++){r=saveDataHandler["getUpgrade"+aUpgradeOffer[o]]()>=n?1:0;a=getSpriteData(assetLib.getData("uiElements"),"upgradePip"+r);ctx.drawImage(a.img,a.bX,a.bY,a.bWidth,a.bHeight,s-a.bWidth/2-81+18*n,d-a.bHeight/2+85,a.bWidth,a.bHeight)}}else addText(0,45,270,"center",s,d-70,"upgradeTitle"+aUpgradeOffer[o],"#333333"),4==aUpgradeOffer.length?(this.renderUpgradeIcon(aUpgradeOffer[0],1,s-90,d+5,85),this.renderUpgradeIcon(aUpgradeOffer[1],1,s,d-15,85),this.renderUpgradeIcon(aUpgradeOffer[2],1,s+90,d+5,85)):(this.renderUpgradeIcon(aUpgradeOffer[0],1,s-50,d-15),this.renderUpgradeIcon(aUpgradeOffer[1],1,s+50,d-15));this.renderSparks(.55*canvas.height,375);break;case"multiplayerLevelEnd":ctx.fillStyle="rgba(0, 0, 0, 0.5)",ctx.fillRect(0,0,canvas.width,canvas.height);var h,d=canvas.height/2,c=(a=getSpriteData(assetLib.getData("uiElements"),"levelShield"+lastPlayerWon),1),l=1+2*this.levelCompleteInc;this.flareRot+=delta/3,ctx.save(),ctx.translate(canvas.width/2,d+10*Math.sin(.3*this.incY)),ctx.rotate(this.flareRot),ctx.scale(2,2),ctx.drawImage(this.oTopFlareImgData.img,-this.oTopFlareImgData.img.width/2,-this.oTopFlareImgData.img.height/2),ctx.restore(),ctx.drawImage(a.img,a.bX,a.bY,a.bWidth,a.bHeight,canvas.width/2-a.bWidth/2*c*l,d-a.bHeight/2*c*l+10*Math.sin(.3*this.incY),a.bWidth*c*l,a.bHeight*c*l),h=0==lastPlayerWon?user:enemy,addText(0,80*c*l,canvas.width-100,"center",canvas.width/2,canvas.height/2+350+1e3*this.levelCompleteInc,"playerWin"+lastPlayerWon,"#FFFFFF"),this.renderTruck(h,canvas.width/2,d-115*c*l+10*Math.sin(.3*this.incY),c*l),this.renderMultiplayerScore(),this.renderSparks(d);break;case"levelSuccess":ctx.fillStyle="rgba(0, 0, 0, 0.5)",ctx.fillRect(0,0,canvas.width,canvas.height);a=getSpriteData(assetLib.getData("uiElements"),"levelShield0");var g=.6;c=Math.min(a.bHeight,.55*canvas.height)/a.bHeight,l=1+2*this.levelCompleteInc;this.flareRot+=delta/3,ctx.save(),ctx.translate(canvas.width/2,canvas.height*g-a.bHeight/2*c*l+10*Math.sin(.3*this.incY)+600*this.levelCompleteInc),ctx.rotate(this.flareRot),ctx.scale(2,2),ctx.drawImage(this.oTopFlareImgData.img,-this.oTopFlareImgData.img.width/2,-this.oTopFlareImgData.img.height/2),ctx.restore(),ctx.drawImage(a.img,a.bX,a.bY,a.bWidth,a.bHeight,canvas.width/2-a.bWidth/2*c*l,canvas.height*g-a.bHeight*c*l+10*Math.sin(.3*this.incY)+600*this.levelCompleteInc,a.bWidth*c*l,a.bHeight*c*l),this.renderTruck(user,canvas.width/2,canvas.height*g-(a.bHeight/2+115)*c*l+10*Math.sin(.3*this.incY)+600*this.levelCompleteInc,c*l),saveDataHandler.upgradesLeft()&&this.renderUpgradeBar(),this.upgradeBarState<2&&this.renderSparks(canvas.height*g-a.bHeight/2*c*l),this.renderBottomUI(),1==this.butDisplayState&&Math.sin(this.incY)>0&&addText(0,77,canvas.width-100,"center",canvas.width/2,.7*canvas.height+225+this.butsY,"next","#FFFFFF");break;case"game":if(isMobile){var m=1;1==gameMode&&(m=2);for(c=oMobileControls["gameMode"+gameMode].scale,o=0;o<m;o++){a=getSpriteData(assetLib.getData("uiElements"),"leftTouch");ctx.drawImage(a.img,a.bX,a.bY,a.bWidth,a.bHeight,oMobileControls["gameMode"+gameMode]["left"+o].x-a.bWidth/2*c,oMobileControls["gameMode"+gameMode]["left"+o].y-a.bHeight/2*c,a.bWidth*c,a.bHeight*c);a=getSpriteData(assetLib.getData("uiElements"),"rightTouch");ctx.drawImage(a.img,a.bX,a.bY,a.bWidth,a.bHeight,oMobileControls["gameMode"+gameMode]["right"+o].x-a.bWidth/2*c,oMobileControls["gameMode"+gameMode]["right"+o].y-a.bHeight/2*c,a.bWidth*c,a.bHeight*c);a=getSpriteData(assetLib.getData("uiElements"),"swingTouch");ctx.drawImage(a.img,a.bX,a.bY,a.bWidth,a.bHeight,oMobileControls["gameMode"+gameMode]["swing"+o].x-a.bWidth/2*c,oMobileControls["gameMode"+gameMode]["swing"+o].y-a.bHeight/2*c,a.bWidth*c,a.bHeight*c);a=getSpriteData(assetLib.getData("uiElements"),"jumpTouch");ctx.drawImage(a.img,a.bX,a.bY,a.bWidth,a.bHeight,oMobileControls["gameMode"+gameMode]["jump"+o].x-a.bWidth/2*c,oMobileControls["gameMode"+gameMode]["jump"+o].y-a.bHeight/2*c,a.bWidth*c,a.bHeight*c)}}if(this.tutInc<1)if(0==gameMode){if(0==aEnemies[0].state){var u=user.body.position.x-aEnemies[0].body.position.x;if(Math.abs(u)>200)if(u<0){a=getSpriteData(assetLib.getData("uiElements"),"tut0"+Math.abs(Math.round(Math.sin(.4*this.incY))));ctx.drawImage(a.img,a.bX,a.bY,a.bWidth,a.bHeight,canvas.width/2-a.bWidth/2,25-500*this.tutInc,a.bWidth,a.bHeight)}else{a=getSpriteData(assetLib.getData("uiElements"),"tut2"+Math.abs(Math.round(Math.sin(.4*this.incY))));ctx.drawImage(a.img,a.bX,a.bY,a.bWidth,a.bHeight,canvas.width/2-a.bWidth/2,25-500*this.tutInc,a.bWidth,a.bHeight)}else{a=getSpriteData(assetLib.getData("uiElements"),"tut1"+Math.abs(Math.round(Math.sin(.4*this.incY))));ctx.drawImage(a.img,a.bX,a.bY,a.bWidth,a.bHeight,canvas.width/2-a.bWidth/2,25-500*this.tutInc+5*Math.sin(3*this.incY),a.bWidth,a.bHeight)}}}else if(1==gameMode){a=getSpriteData(assetLib.getData("uiElements"),"tut30");ctx.drawImage(a.img,a.bX,a.bY,a.bWidth,a.bHeight,25,canvas.height-a.bHeight-25+500*this.tutInc,a.bWidth,a.bHeight);a=getSpriteData(assetLib.getData("uiElements"),"tut31");ctx.drawImage(a.img,a.bX,a.bY,a.bWidth,a.bHeight,canvas.width-a.bWidth-25,canvas.height-a.bHeight-25+500*this.tutInc,a.bWidth,a.bHeight)}if(isMobile||1!=gameMode)0==gameMode&&this.renderBottomUI();else{if(!multiplayerHasHit&&multiplayerIsClose&&(this.tutDelayInc=2,0==this.tutInc&&(this.tutTween&&this.tutTween.kill(),this.tutTween=TweenLite.to(this,.5,{tutInc:1,ease:"Back.easeIn",onComplete:function(){}}))),this.tutDelayInc>=0){a=getSpriteData(assetLib.getData("uiElements"),"tut1"+Math.abs(Math.round(Math.sin(.4*this.incY))));ctx.drawImage(a.img,a.bX,a.bY,a.bWidth,a.bHeight,canvas.width/2-a.bWidth/2,canvas.height-(a.bHeight+25)+5*Math.sin(3*this.incY),a.bWidth,a.bHeight)}this.tutDelayInc>=0&&(this.tutDelayInc-=delta),this.renderMultiplayerScore()}if(isMobile&&1==gameMode&&canvas.height>canvas.width){ctx.fillStyle="rgba(0, 0, 0, 0.75)",ctx.fillRect(0,0,canvas.width,canvas.height);a=getSpriteData(assetLib.getData("uiElements"),"rotateMessage");ctx.drawImage(a.img,a.bX,a.bY,a.bWidth,a.bHeight,canvas.width/2-a.bWidth/2,canvas.height/2-a.bHeight/2,a.bWidth,a.bHeight)}break;case"pause":ctx.fillStyle="rgba(0, 0, 0, 0.75)",ctx.fillRect(0,0,canvas.width,canvas.height);for(o=0;o<3;o++)addText(0,55,canvas.width/2,"center",canvas.width/2-250+250*o,.5*canvas.height+160+this.butsY,"pauseBut"+o,"#FFFFFF")}t&&this.addButs(ctx)},t.prototype.renderUpgradeIcon=function(e,t,a,i,s){var r;void 0===s&&(s=92);var o=1,n=s;switch(0==t?n*=.85:1==t&&(n=.85*n+.15*n*Math.abs(Math.sin(this.incY+e))),e){case 0:r=getSpriteData(assetLib.getData("gameElements"),"body"+(saveDataHandler.getUpgrade0()+t));break;case 1:r=getSpriteData(assetLib.getData("gameElements"),"mace"+(saveDataHandler.getUpgrade1()+t));break;case 2:r=getSpriteData(assetLib.getData("gameElements"),"chassis"+(saveDataHandler.getUpgrade2()+t));break;case 3:r=getSpriteData(assetLib.getData("gameElements"),"wheel"+(saveDataHandler.getUpgrade3()+t))}0==e?(ctx.fillStyle="#333333",ctx.fillRect(a-n/2,i-n/2,n,n),ctx.drawImage(r.img,r.bX+(r.bWidth/2-(n-6)/2),r.bY+(r.bHeight/2-(n-6)/2),n-6,n-6,a-(n-6)/2,i-(n-6)/2,n-6,n-6)):(o=n/Math.max(r.bWidth,r.bHeight),ctx.drawImage(r.img,r.bX,r.bY,r.bWidth,r.bHeight,a-r.bWidth/2*o,i-r.bHeight/2*o,r.bWidth*o,r.bHeight*o))},t.prototype.renderUpgradeBar=function(){var t=this,a=.75*canvas.height;if(1==this.upgradeBarState){if(this.upgradeBarId=0,this.upgradeCogInc-=delta,this.upgradeCogInc<0)if(upgradeCogCount<this.upgradeCogTarg){this.upgradeCogInc=.5,upgradeCogCount++,curCogs--,playSound("coin"+Math.floor(3*Math.random()),.35),this.upgradeBarJiggle=25,TweenLite.to(this,.3,{upgradeBarJiggle:0,ease:"Elastic.easeOut"});var i=canvas.width/2-339+59.7*(upgradeCogCount-1),s=a,r=new e.Pop(i,s,50);aUnderEffects.push(r);for(var o=0;o<6;o++){var n=new e.ParticleLine(i,s,1*Math.random()+1,200*Math.random()+100,60*o*radian,20,1.5,50,"#FFFFF");aUnderEffects.push(n)}10==upgradeCogCount&&(this.upgradeBarState=2,setTimeout((function(){t.upgradeBarJiggle=50,TweenLite.to(t,.3,{upgradeBarJiggle:0,ease:"Elastic.easeOut"}),t.upgradeBarId=1,t.upgradeCogInc=0,t.upgradeBarState=3,1==audioType&&music.fade(music.volume(),0,500);var a=new e.Pop(i+100,s,200);aUnderEffects.push(a),playSound("hit4",.5),setTimeout((function(){playSound("upgradeSweep",1)}),800)}),500),setTimeout((function(){1==audioType&&music.fade(music.volume(),.1,500),initUpgradeScreen(),playSound("upgradeFull",1)}),2500))}else upgradeCogCount==this.upgradeCogTarg&&(this.upgradeBarState=4,this.levelCompleteTween=TweenLite.to(this,.25,{levelCompleteInc:1,delay:.5,ease:"Cubic.easeIn",onComplete:function(){showAd((function(){initNextP1Level()}))}}))}else if(3==this.upgradeBarState){this.upgradeCogInc+=delta,this.upgradeBarJiggle=Math.sin(5*this.incY)*Math.min(15,5*this.upgradeCogInc);i=canvas.width/2+320,s=a;if(Math.random()>.5){n=new e.ParticleLine(i,s,1*Math.random()+1,200*Math.random()+100,360*Math.random()*radian,10*this.upgradeCogInc*3,1.5,100,"#FFFFFF");aUnderEffects.push(n)}}var h=getSpriteData(assetLib.getData("uiElements"),"upgradeBar"+this.upgradeBarId);ctx.drawImage(h.img,h.bX,h.bY,h.bWidth,h.bHeight,canvas.width/2-h.bWidth/2,a-h.bHeight/2+600*this.levelCompleteInc+this.upgradeBarJiggle,h.bWidth,h.bHeight);for(o=0;o<upgradeCogCount;o++){h=getSpriteData(assetLib.getData("uiElements"),"upgradeCog");ctx.drawImage(h.img,h.bX,h.bY,h.bWidth,h.bHeight,canvas.width/2-h.bWidth/2-339+59.7*o,a-h.bHeight/2+600*this.levelCompleteInc+this.upgradeBarJiggle,h.bWidth,h.bHeight)}},t.prototype.renderSparks=function(t,a){if(void 0===a&&(a=200),Math.random()>.5){var i=new e.ParticleLine(canvas.width/2,t,1*Math.random()+1,300,360*Math.random()*radian,20,2,a);aUnderEffects.push(i);var s=new e.Particle(0,canvas.width/2,t,15*Math.random()+15,200*Math.random()+100,2*Math.random()+1.5,360*Math.random()*radian,a,!0);aUnderEffects.push(s)}},t.prototype.renderMultiplayerScore=function(){addDirectText(0,120,canvas.width/2,"right",canvas.width/2-30,95,p1Score.toString(),"#0087FF"),addDirectText(0,120,canvas.width/2,"right",canvas.width/2-30,90,p1Score.toString(),"#FFFFFF"),addDirectText(0,120,canvas.width/2,"center",canvas.width/2,90,"-","#FFFFFF"),addDirectText(0,120,canvas.width/2,"left",canvas.width/2+30,95,p2Score.toString(),"#F54604"),addDirectText(0,120,canvas.width/2,"left",canvas.width/2+30,90,p2Score.toString(),"#FFFFFF"),addText(0,40,canvas.width/2,"right",canvas.width/2-30-getDirectWidth(0,120,p1Score.toString())-10,45,"pShort0","#FFFFF"),addText(0,40,canvas.width/2,"left",canvas.width/2+30+getDirectWidth(0,120,p2Score.toString())+10,45,"pShort1","#FFFFF")},t.prototype.renderTruck=function(e,t,a,i){var s=getSpriteData(assetLib.getData("gameElements"),"body"+e.bodyId);ctx.drawImage(s.img,s.bX,s.bY,s.bWidth,s.bHeight,t-s.bWidth/2*i,a-s.bHeight/2*i,s.bWidth*i,s.bHeight*i);s=getSpriteData(assetLib.getData("gameElements"),"chassis"+e.chassisId);ctx.drawImage(s.img,s.bX,s.bY,s.bWidth,s.bHeight,t-s.bWidth/2*i,a-(s.bHeight/2-35)*i,s.bWidth*i,s.bHeight*i);s=getSpriteData(assetLib.getData("gameElements"),"wheel"+e.wheelId);ctx.drawImage(s.img,s.bX,s.bY,s.bWidth,s.bHeight,t-(s.bWidth/2+70)*i,a-(s.bHeight/2-35)*i,s.bWidth*i,s.bHeight*i),ctx.drawImage(s.img,s.bX,s.bY,s.bWidth,s.bHeight,t-(s.bWidth/2-70)*i,a-(s.bHeight/2-35)*i,s.bWidth*i,s.bHeight*i)},t.prototype.renderBottomUI=function(){var e,t;t=getDirectWidth(0,77,e=twoDigit(curLevel+1));var a=getSpriteData(assetLib.getData("uiElements"),"scoreBar0");ctx.drawImage(a.img,a.bX,a.bY,a.bWidth,a.bHeight,-a.bWidth+t+120,canvas.height-50-a.bHeight/2,a.bWidth,a.bHeight);a=getSpriteData(assetLib.getData("uiElements"),"cupSmall");ctx.drawImage(a.img,a.bX,a.bY,a.bWidth,a.bHeight,t+40,canvas.height-50-a.bHeight/2,a.bWidth,a.bHeight),addDirectText(0,77,canvas.width/2,"left",30,canvas.height-26,e,"#FFFFFF"),t=getDirectWidth(0,77,e=curCogs+"/3");a=getSpriteData(assetLib.getData("uiElements"),"scoreBar1");ctx.drawImage(a.img,a.bX,a.bY,a.bWidth,a.bHeight,canvas.width-(t+110),canvas.height-50-a.bHeight/2,a.bWidth,a.bHeight);a=getSpriteData(assetLib.getData("uiElements"),"cogSmall");ctx.drawImage(a.img,a.bX,a.bY,a.bWidth,a.bHeight,canvas.width-a.bWidth-t-40,canvas.height-50-a.bHeight/2,a.bWidth,a.bHeight),addDirectText(0,77,canvas.width/2,"right",canvas.width-30,canvas.height-26,e,"#FFFFFF")},t.prototype.addButs=function(e){for(var t=!1,a=0;a<this.aButs.length;a++)if(this.aButs[a].isOver){t=!0;break}for(a=0;a<this.aButs.length;a++){var i,s,r,o,n,h=0;0!=this.incY&&this.aButs[a].flash&&(h=this.aButs[a].isOver?3*Math.sin(2*(this.incY+2.5*a)):3*Math.sin(this.incY+2.5*a)),this.aButs[a].scale||(this.aButs[a].scale=1),s=this.aButs[a].oImgData.oData.oAtlasData[this.aButs[a].id].x,r=this.aButs[a].oImgData.oData.oAtlasData[this.aButs[a].id].y,o=this.aButs[a].oImgData.oData.oAtlasData[this.aButs[a].id].width,n=this.aButs[a].oImgData.oData.oAtlasData[this.aButs[a].id].height;var d=canvas.width*this.aButs[a].align[0],c=canvas.height*this.aButs[a].align[1];i=c+this.aButs[a].aPos[1]>100?this.butsY:-this.butsY,this.aButs[a].aOverData=new Array(d+this.aButs[a].aPos[0]-o/2*this.aButs[a].scale-h/2,c+this.aButs[a].aPos[1]-n/2*this.aButs[a].scale+i+h/2,d+this.aButs[a].aPos[0]+o/2*this.aButs[a].scale-h/2,c+this.aButs[a].aPos[1]+n/2*this.aButs[a].scale+i+h/2),this.aButs[a].isOver&&this.aButs[a].flash&&(e.save(),e.translate(d+this.aButs[a].aPos[0],c+this.aButs[a].aPos[1]),e.scale(.7+h/30,.7+h/30),e.globalAlpha=1,e.rotate(this.incY/7),e.drawImage(this.oTopFlareImgData.img,-this.oTopFlareImgData.img.width/2,-this.oTopFlareImgData.img.height/2),e.restore()),e.drawImage(this.aButs[a].oImgData.img,s,r,o,n,this.aButs[a].aOverData[0],this.aButs[a].aOverData[1],o*this.aButs[a].scale+h,n*this.aButs[a].scale-h),(this.aButs[a].isOver||this.aButs[a].flash)&&(e.save(),this.aButs[a].isOver?e.globalAlpha=1:e.globalAlpha=t?Math.max(Math.sin(this.incY/2),0)/2:Math.max(Math.sin(this.incY/2),0),s=this.aButs[a].oImgData.oData.oAtlasData[this.aButs[a].idOver].x,r=this.aButs[a].oImgData.oData.oAtlasData[this.aButs[a].idOver].y,o=this.aButs[a].oImgData.oData.oAtlasData[this.aButs[a].idOver].width,n=this.aButs[a].oImgData.oData.oAtlasData[this.aButs[a].idOver].height,e.drawImage(this.aButs[a].oImgData.img,s,r,o,n,this.aButs[a].aOverData[0],this.aButs[a].aOverData[1],o*this.aButs[a].scale+h,n*this.aButs[a].scale-h),e.restore())}},t}();e.Panel=t}(Elements||(Elements={})),function(e){var t=function(){function e(){this.oTextData={},this.inc=0,this.createTextObjects()}return e.prototype.createTextObjects=function(){for(var e in assetLib.textData.langText.text[curLang])this.oTextData[e]={},this.oTextData[e].aLineData=this.getCharData(assetLib.textData.langText.text[curLang][e]["@text"],assetLib.textData.langText.text[curLang][e]["@fontId"]),this.oTextData[e].aLineWidths=this.getLineWidths(this.oTextData[e].aLineData),this.oTextData[e].blockWidth=this.getBlockWidth(this.oTextData[e].aLineData),this.oTextData[e].blockHeight=this.getBlockHeight(this.oTextData[e].aLineData,assetLib.textData.langText.text[curLang][e]["@fontId"]),this.oTextData[e].lineHeight=parseInt(assetLib.textData["fontData"+assetLib.textData.langText.text[curLang][e]["@fontId"]].text.common["@lineHeight"]),this.oTextData[e].oFontImgData=assetLib.getData("font"+assetLib.textData.langText.text[curLang][e]["@fontId"])},e.prototype.getLineWidths=function(e){for(var t,a=new Array,i=0;i<e.length;i++){t=0;for(var s=0;s<e[i].length;s++)t+=parseInt(e[i][s]["@xadvance"]),0==s?t-=parseInt(e[i][s]["@xoffset"]):s==e[i].length-1&&(t+=parseInt(e[i][s]["@xoffset"]));a.push(t)}return a},e.prototype.getBlockWidth=function(e){for(var t,a=0,i=0;i<e.length;i++){t=0;for(var s=0;s<e[i].length;s++)t+=parseInt(e[i][s]["@xadvance"]),0==s?t-=parseInt(e[i][s]["@xoffset"]):s==e[i].length-1&&(t+=parseInt(e[i][s]["@xoffset"]));t>a&&(a=t)}return a},e.prototype.getBlockHeight=function(e,t){return e.length*parseInt(assetLib.textData["fontData"+t].text.common["@lineHeight"])},e.prototype.getCharData=function(e,t){for(var a=new Array,i=0;i<e.length;i++){a[i]=new Array;for(var s=0;s<e[i].length;s++)for(var r=0;r<assetLib.textData["fontData"+t].text.chars.char.length;r++)e[i][s].charCodeAt(0)==assetLib.textData["fontData"+t].text.chars.char[r]["@id"]&&a[i].push(assetLib.textData["fontData"+t].text.chars.char[r])}return a},e.prototype.renderText=function(e){var t,a=this.oTextData[e.text].aLineData,i=this.oTextData[e.text].oFontImgData,s=0,r=0,o=0,n=1,h=0;e.lineOffsetY&&(o=e.lineOffsetY),e.scale&&(n=e.scale);var d=1*n;e.maxWidth&&this.oTextData[e.text].blockWidth*n>e.maxWidth&&(d=e.maxWidth/this.oTextData[e.text].blockWidth),e.anim&&(this.inc+=7*delta);for(var c=0;c<a.length;c++){t=0,"centre"==e.alignX&&(s=this.oTextData[e.text].aLineWidths[c]/2),"centre"==e.alignY&&(r=this.oTextData[e.text].blockHeight/2+o*(a.length-1)/2);for(var l=0;l<a[c].length;l++){var g=a[c][l]["@x"],m=a[c][l]["@y"],u=a[c][l]["@width"],p=a[c][l]["@height"];e.anim&&(h=Math.sin(this.inc+l/2)*(p/15*d)),ctx.drawImage(i.img,g,m,u,p,e.x+(t+parseInt(a[c][l]["@xoffset"])-s)*d,e.y+(parseInt(a[c][l]["@yoffset"])+c*this.oTextData[e.text].lineHeight+c*o-r)*d+h,u*d,p*d),t+=parseInt(a[c][l]["@xadvance"])}}},e}();e.TextDisplay=t}(Utils||(Utils={})),function(e){var t=function(){function e(e){this.elementRotSpeed=.5,this.aStaticOutlineColours=new Array("#7F5C42","#8D7158","#9B866F","#AA9C87","#B8B19D"),this.aNonStaticOutlineColours=new Array("#CDA16D","#C5975F","#BD8C52","#B48145","#AC7737"),this.aTexturePos=new Array({x:0,y:0},{x:0,y:-1},{x:-1,y:-1},{x:-1,y:0}),this.inc=0,this.aSceneryIds=new Array,this.windSpeed=750,this.exitPortalScale=0,this.teleportScale=1,this.teleportScaleId=null,this.aSurfaceObjects=e;for(var t=0;t<20;t++)this.aSceneryIds.push(t);this.setScene()}return e.prototype.triggerTeleport=function(e){this.teleportTween&&this.teleportTween.kill(),this.teleportScale=2,this.teleportScaleId=e,this.teleportTween=TweenLite.to(this,.5,{teleportScale:1,ease:"Back.easeIn"})},e.prototype.removeScene=function(){this.aMatters&&Composite.remove(engine.world,this.aMatters)},e.prototype.setScene=function(){this.removeScene(),Math.seedrandom(curLevel+1),this.aSceneryIds=shuffleArray(this.aSceneryIds),this.aMatters=new Array;for(var e=0;e<this.aSurfaceObjects.length;e++){decomp.makeCCW(this.aSurfaceObjects[e].aBasicPoints);for(var t,a=decomp.quickDecomp(this.aSurfaceObjects[e].aBasicPoints),i=new Array,s=0;s<a.length;s++){for(var r=new Array,o=0;o<a[s].length;o++)r.push({x:a[s][o][0],y:a[s][o][1]});i.push(r)}0==this.aSurfaceObjects[e].state?t=Bodies.fromVertices(0,0,i,{isStatic:!0,label:this.aSurfaceObjects[e].state}):1==this.aSurfaceObjects[e].state?(t=Bodies.fromVertices(0,0,i,{isStatic:!1,label:this.aSurfaceObjects[e].state}),hasGravity||(Matter.Body.setAngularVelocity(t,.04*Math.random()-.02),Matter.Body.setVelocity(t,{x:4*Math.random()-2,y:4*Math.random()-2}),t.frictionAir=0)):2!=this.aSurfaceObjects[e].state&&3!=this.aSurfaceObjects[e].state&&4!=this.aSurfaceObjects[e].state||(t=Bodies.fromVertices(0,0,i,{isStatic:!1,label:this.aSurfaceObjects[e].state})),this.aMatters.push(t);var n=(t.bounds.min.x+t.bounds.max.x)/2,h=(t.bounds.min.y+t.bounds.max.y)/2;if(Matter.Body.setPosition(t,{x:-n+this.aSurfaceObjects[e].centerPoint.x,y:-h+this.aSurfaceObjects[e].centerPoint.y}),2==this.aSurfaceObjects[e].state||3==this.aSurfaceObjects[e].state||4==this.aSurfaceObjects[e].state){var d=Constraint.create({pointA:{x:t.position.x,y:t.position.y},bodyB:t,pointB:{x:0,y:0},stiffness:1,length:0});Composite.add(engine.world,d)}}Composite.add(engine.world,this.aMatters)},e.prototype.bombExplode=function(e){for(var t=0;t<this.aMatters.length;t++)if(1==this.aMatters[t].label){var a=this.aMatters[t].position.x-e.x,i=this.aMatters[t].position.y-e.y,s=Math.sqrt(a*a+i*i);if(s<200){var r=(200-s)/200*25,o=Math.atan2(i,a),n=Matter.Body.getVelocity(this.aMatters[t]);Matter.Body.setVelocity(this.aMatters[t],{x:n.x+r*Math.cos(o),y:n.y+r*Math.cos(o)})}}},e.prototype.update=function(){this.inc+=delta;for(var e=0;e<this.aMatters.length;e++)if(2==this.aMatters[e].label)Body.setAngularVelocity(this.aMatters[e],this.elementRotSpeed*delta);else if(1==this.aMatters[e].label&&aPush.length>0){var t=checkWind(this.aMatters[e].position.x,this.aMatters[e].position.y),a=Matter.Body.getVelocity(this.aMatters[e]);Matter.Body.setVelocity(this.aMatters[e],{x:a.x+200*t.x*delta,y:a.y+200*t.y*delta})}},e.prototype.renderTexture=function(){for(var e=assetLib.getData("texture0"),t=0;t<4;t++){var a=0+cameraX+999*this.aTexturePos[t].x*cameraScale,i=0+cameraY+999*this.aTexturePos[t].y*cameraScale;ctx.drawImage(e.img,0,0,e.img.width,e.img.height,a,i,e.img.width*cameraScale,e.img.height*cameraScale)}},e.prototype.renderScenery=function(){for(var e=0;e<aScenery.length;e++){var t=getSpriteData(assetLib.getData("scenery"),"scenery"+this.aSceneryIds[e]);ctx.drawImage(t.img,t.bX,t.bY,t.bWidth,t.bHeight,cameraX+(aScenery[e].x-t.bWidth/2)*cameraScale,cameraY+(aScenery[e].y-t.bHeight-15)*cameraScale,t.bWidth*cameraScale,t.bHeight*cameraScale)}},e.prototype.renderPushAreas=function(){for(var e=0;e<aPush.length;e++)if(0==aPush[e].s)if(0==aPush[e].vx){var t=assetLib.getData("wind0");1==aPush[e].vy?ctx.drawImage(t.img,0,t.img.height/2-this.inc*this.windSpeed%(t.img.height/2),t.img.width,t.img.height/2,cameraX+(aPush[e].x-aPush[e].w/2)*cameraScale,cameraY+(aPush[e].y-aPush[e].h/2)*cameraScale,aPush[e].w*cameraScale,aPush[e].h*cameraScale):ctx.drawImage(t.img,0,0+this.inc*this.windSpeed%(t.img.height/2),t.img.width,t.img.height/2,cameraX+(aPush[e].x-aPush[e].w/2)*cameraScale,cameraY+(aPush[e].y-aPush[e].h/2)*cameraScale,aPush[e].w*cameraScale,aPush[e].h*cameraScale)}else{t=assetLib.getData("wind1");1==aPush[e].vx?ctx.drawImage(t.img,t.img.width/2-this.inc*this.windSpeed%(t.img.width/2),0,t.img.width/2,t.img.height,cameraX+(aPush[e].x-aPush[e].w/2)*cameraScale,cameraY+(aPush[e].y-aPush[e].h/2)*cameraScale,aPush[e].w*cameraScale,aPush[e].h*cameraScale):ctx.drawImage(t.img,0+this.inc*this.windSpeed%(t.img.width/2),0,t.img.width/2,t.img.height,cameraX+(aPush[e].x-aPush[e].w/2)*cameraScale,cameraY+(aPush[e].y-aPush[e].h/2)*cameraScale,aPush[e].w*cameraScale,aPush[e].h*cameraScale)}else 1==aPush[e].s&&(ctx.strokeStyle="#C9F4FF",ctx.lineWidth=(2.5*Math.sin(15*this.inc)+5)*cameraScale,ctx.moveTo(cameraX+(aPush[e].x-aPush[e].w/2)*cameraScale,cameraY+(aPush[e].y-aPush[e].h/2+3*Math.sin(8*this.inc))*cameraScale),ctx.lineTo(cameraX+(aPush[e].x+aPush[e].w/2)*cameraScale,cameraY+(aPush[e].y-aPush[e].h/2+3*Math.sin(8*this.inc))*cameraScale),ctx.stroke(),ctx.fillStyle="rgba(35, 191, 217, 0.65)",ctx.fillRect(cameraX+(aPush[e].x-aPush[e].w/2)*cameraScale,cameraY+(aPush[e].y-aPush[e].h/2+3*Math.sin(8*this.inc))*cameraScale,aPush[e].w*cameraScale,aPush[e].h*cameraScale))},e.prototype.render=function(){var e,t,a;this.renderScenery(),this.renderPushAreas(),ctx.lineWidth=10*cameraScale,ctx.lineJoin="round",ctx.fillStyle="#985C14";for(var i=0;i<5;i++){ctx.strokeStyle=this.aNonStaticOutlineColours[i],e=0*i,t=5*i-10,a=1.01-5*(5-i)*.001;for(var s=0;s<this.aMatters.length;s++)if(this.aMatters[s].label>=1&&this.aMatters[s].label<=4){ctx.beginPath(),ctx.moveTo(cameraX+(this.aMatters[s].vertices[0].x*a+e)*cameraScale,cameraY+(this.aMatters[s].vertices[0].y+t)*cameraScale);for(var r=1;r<this.aMatters[s].vertices.length;r++)ctx.lineTo(cameraX+(this.aMatters[s].vertices[r].x*a+e)*cameraScale,cameraY+(this.aMatters[s].vertices[r].y+t)*cameraScale);ctx.lineTo(cameraX+(this.aMatters[s].vertices[0].x*a+e)*cameraScale,cameraY+(this.aMatters[s].vertices[0].y+t)*cameraScale),ctx.closePath(),ctx.stroke(),ctx.fill(),2!=this.aMatters[s].label&&3!=this.aMatters[s].label&&4!=this.aMatters[s].label||4!=i||(ctx.beginPath(),ctx.arc(cameraX+(this.aMatters[s].position.x*a+e)*cameraScale,cameraY+(this.aMatters[s].position.y*a+t)*cameraScale,8*cameraScale,0,2*Math.PI),ctx.fillStyle="#68442C",ctx.fill(),ctx.fillStyle="#985C14")}ctx.strokeStyle=this.aStaticOutlineColours[4-i];for(s=0;s<this.aSurfaceObjects.length;s++)if(0==this.aSurfaceObjects[s].state){ctx.beginPath(),ctx.moveTo(cameraX+(this.aSurfaceObjects[s].aPoints[0].x*a+e)*cameraScale,cameraY+(this.aSurfaceObjects[s].aPoints[0].y+t)*cameraScale);for(r=1;r<this.aSurfaceObjects[s].aPoints.length;r++)ctx.lineTo(cameraX+(this.aSurfaceObjects[s].aPoints[r].x*a+e)*cameraScale,cameraY+(this.aSurfaceObjects[s].aPoints[r].y+t)*cameraScale);ctx.lineTo(cameraX+(this.aSurfaceObjects[s].aPoints[0].x*a+e)*cameraScale,cameraY+(this.aSurfaceObjects[s].aPoints[0].y+t)*cameraScale),ctx.closePath(),ctx.stroke()}}a=1.01;for(s=0;s<this.aSurfaceObjects.length;s++)if(0==this.aSurfaceObjects[s].state){ctx.save(),ctx.beginPath(),ctx.moveTo(cameraX+(this.aSurfaceObjects[s].aPoints[0].x*a+e)*cameraScale,cameraY+(this.aSurfaceObjects[s].aPoints[0].y+t)*cameraScale);for(r=1;r<this.aSurfaceObjects[s].aPoints.length;r++)ctx.lineTo(cameraX+(this.aSurfaceObjects[s].aPoints[r].x*a+e)*cameraScale,cameraY+(this.aSurfaceObjects[s].aPoints[r].y+t)*cameraScale);ctx.lineTo(cameraX+(this.aSurfaceObjects[s].aPoints[0].x*a+e)*cameraScale,cameraY+(this.aSurfaceObjects[s].aPoints[0].y+t)*cameraScale),ctx.closePath(),ctx.clip(),this.renderTexture(),ctx.restore()}for(s=0;s<aTeleports.length;s++){var o=this.teleportScale,n=getSpriteData(assetLib.getData("gameElements"),"exitPortal1");ctx.save(),ctx.translate(cameraX+aTeleports[s].x*cameraScale,cameraY+aTeleports[s].y*cameraScale),ctx.scale(.5*cameraScale*(1+.1*Math.sin(15*this.inc))*o,.5*cameraScale*(1-.1*Math.sin(10*this.inc))*o),ctx.rotate(5*this.inc),ctx.drawImage(n.img,n.bX,n.bY,n.bWidth,n.bHeight,-n.bWidth/2,-n.bHeight/2,n.bWidth,n.bHeight),ctx.rotate(7*-this.inc),ctx.rotate(5*-this.inc);n=getSpriteData(assetLib.getData("gameElements"),"exitPortal0");ctx.drawImage(n.img,n.bX,n.bY,n.bWidth,n.bHeight,-n.bWidth/2,-n.bHeight/2,n.bWidth,n.bHeight),ctx.restore()}},e.prototype.renderExitMarker=function(){var e=Math.atan2(cameraY+oExitPortal.y*cameraScale-canvas.height/2,cameraX+oExitPortal.x*cameraScale-canvas.width/2),t=getSpriteData(assetLib.getData("uiElements"),"exitDistMarker");if(ctx.save(),ctx.translate(canvas.width/2+canvas.width/2*.92*Math.cos(e),canvas.height/2+canvas.height/2*.92*Math.sin(e)),ctx.rotate(e),ctx.drawImage(t.img,t.bX,t.bY,t.bWidth,t.bHeight,-t.bWidth/2,-t.bHeight/2,t.bWidth,t.bHeight),ctx.restore(),Math.sin(15*this.inc)>0){t=getSpriteData(assetLib.getData("uiElements"),"exitMarker");ctx.save(),ctx.translate(canvas.width/2+(canvas.width/2*.92-75)*Math.cos(e),canvas.height/2+(canvas.height/2*.92-75)*Math.sin(e)),ctx.rotate(10*this.inc),ctx.drawImage(t.img,t.bX,t.bY,t.bWidth,t.bHeight,-t.bWidth/2,-t.bHeight/2,t.bWidth,t.bHeight),ctx.restore()}},e}();e.Scene=t}(Elements||(Elements={})),function(e){var t=function(){function t(e){this.removeMe=!1,this.x=0,this.y=0,this.moveRight=0,this.moveLeft=0,this.moveUp=0,this.moveDown=0,this.jumpPower=12,this.jumpRate=.5,this.wheelRot=0,this.energy=1,this.swingState=0,this.swingAngle=0,this.endSwingAngle=0,this.enemyNearAngle=null,this.swingTimeInc=0,this.smokeInc=0,this.swingRange=0,this.swingRate=0,this.hitDamage=1,this.popRecoverInc=0,this.hitRecoverInc=0,this.hitFlashInc=0,this.swingInc=0,this.nearTeleport=null,this.swingDuration=.5,this.newWind=!0,this.damageRecoverInc=0,this.inc=0,this.state=0,this.jumpInc=0,this.speed=0,this.trailInc=0,this.oParts={wheelOffsetX:35,wheelOffsetY:0,armWidth:5,armHeight:80,wheelRadius:25,maceOffsetX:0,maceOffsetY:-90,maceRadius:35},this.groundContact=!1,this.allowGroundSound=!0,this.wheelScale0=1,this.wheelScale1=1,this.oStartPos=e,this.id=e.id}return t.prototype.createMatter=function(){var e,t=this.oStartPos.x,a=this.oStartPos.y,i=Body.nextGroup(!0);this.composite=Composite.create({label:"player"}),this.aConstraints=new Array,this.aBodyParts=new Array,this.body=Bodies.rectangle(t,a,70,40,{collisionFilter:{group:i},label:this.id}),this.arm=Bodies.rectangle(t,a+this.oParts.maceOffsetY,this.oParts.armWidth,this.oParts.armHeight,{collisionFilter:{group:i},label:this.id,mass:.1}),this.mace=Bodies.circle(t+this.oParts.maceOffsetX,a+this.oParts.maceOffsetY,this.oParts.maceRadius,{collisionFilter:{group:i},label:this.id,mass:.2}),e=0==this.playerType||1==gameMode?.7:.01,this.wheel0=Bodies.circle(t-this.oParts.wheelOffsetX,a+this.oParts.wheelOffsetY,this.oParts.wheelRadius*this.wheelScale0,{collisionFilter:{group:i},friction:e,label:this.id}),this.wheel1=Bodies.circle(t+this.oParts.wheelOffsetX,a+this.oParts.wheelOffsetY,this.oParts.wheelRadius*this.wheelScale1,{collisionFilter:{group:i},friction:e,label:this.id});var s=Constraint.create({bodyB:this.body,pointB:{x:0,y:0},bodyA:this.arm,pointA:{x:0,y:this.oParts.maceOffsetY/2},stiffness:1,length:0}),r=Constraint.create({bodyB:this.arm,pointB:{x:0,y:-this.oParts.maceOffsetY/2},bodyA:this.mace,stiffness:1,length:0}),o=Constraint.create({bodyB:this.body,pointB:{x:this.oParts.wheelOffsetX,y:this.oParts.wheelOffsetY},bodyA:this.wheel1,stiffness:.5,length:0}),n=Constraint.create({bodyB:this.body,pointB:{x:-this.oParts.wheelOffsetX,y:this.oParts.wheelOffsetY},bodyA:this.wheel0,stiffness:.5,length:0});this.aConstraints.push(s,r,o,n),this.aBodyParts.push({asset:"arm",body:this.arm},{asset:"mace",body:this.mace},{asset:"body",body:this.body},{asset:"wheel",body:this.wheel0,posId:0},{asset:"wheel",body:this.wheel1,posId:1});for(var h=0;h<this.aBodyParts.length;h++)Composite.add(this.composite,this.aBodyParts[h].body),hasGravity||(this.aBodyParts[h].body.frictionAir=0);for(h=0;h<this.aConstraints.length;h++)Composite.add(this.composite,this.aConstraints[h]);Composite.add(engine.world,this.composite),1==this.playerType?aEnemyBodyParts.push(this.body,this.wheel0,this.wheel1,this.mace):aUserBodyParts.push(this.body,this.wheel0,this.wheel1,this.mace),Matter.Body.setAngle(this.arm,120*radian),hasGravity||(Matter.Body.setAngularVelocity(this.body,.01),Matter.Body.setVelocity(this.body,{x:2*Math.random()-1,y:2*Math.random()-1}))},t.prototype.damage=function(t,a,i){if(this.damageRecoverInc<=0){playSound("hit"+Math.floor(8*Math.random()),.5),this.damageRecoverInc=.5,this.energy-=i;var s=new e.TextFloat(this.body.position.x,this.body.position.y-50,Math.round(100*i).toString());aOverEffects.push(s),this.hitFlashInc=.2;for(var r=Math.floor(5*Math.random()+5),o=0;o<r;o++){var n=new e.ParticleLine(t.position.x,t.position.y,1*Math.random()+1,200*Math.random()+100,360/r*o*radian,20,1.5,50,"#FFFF00");aUnderEffects.push(n)}for(r=Math.floor(5*Math.random()+5),o=0;o<r;o++){var h=new e.Particle(0,t.position.x,t.position.y,7*Math.random()+7,200*Math.random()+100,1.5*Math.random()+1.5,360*Math.random()*radian,0,!1);aUnderEffects.push(h)}this.energy<=0&&(Matter.Body.setVelocity(this.body,{x:0,y:0}),this.destroy())}},t.prototype.hitPart=function(t,a){var i=a.mace.position.x,s=a.mace.position.y;if(this.hitRecoverInc<=0){playSound("hit"+Math.floor(8*Math.random()),.5),this.hitRecoverInc=.5;var r=Math.round(100*(a.hitDamage+.05*Math.random()))/100;0==gameMode&&0==this.playerType&&(r*=1-saveDataHandler.getUpgrade0()*aUpgrades[1].perc/100);var o=Matter.Body.getVelocity(this.body),n=Math.atan2(this.body.position.y-a.body.position.y,this.body.position.x-a.body.position.x);Matter.Body.setVelocity(this.body,{x:o.x+100*r*Math.cos(n),y:o.y+100*r*Math.sin(n)}),this.energy-=r;Matter.Body.setAngularVelocity(this.body,2*Math.random()-1);var h=new e.TextFloat(this.body.position.x,this.body.position.y-50,Math.round(100*r).toString());aOverEffects.push(h),this.hitFlashInc=.2;var d=new e.Pop(t.position.x,t.position.y,50);aUnderEffects.push(d);for(var c=Math.floor(5*Math.random()+5),l=0;l<c;l++){var g=new e.ParticleLine(i,s,1*Math.random()+1,200*Math.random()+100,360/c*l*radian,20,1.5,50,"#FFFF00");aUnderEffects.push(g)}for(c=Math.floor(5*Math.random()+5),l=0;l<c;l++){var m=new e.Particle(0,i,s,7*Math.random()+7,200*Math.random()+100,1.5*Math.random()+1.5,360*Math.random()*radian,0,!1);aUnderEffects.push(m)}this.energy<=0&&(Matter.Body.setVelocity(this.body,{x:0,y:0}),this.destroy()),1!=gameMode||multiplayerHasHit||(multiplayerHasHit=!0)}},t.prototype.destroy=function(){var t=this;this.state=1;for(var a=0;a<4;a++)setTimeout((function(){var a=new e.Pop(t.body.position.x+200*Math.random()-100,t.body.position.y+200*Math.random()-100,50*Math.random()+50);aUnderEffects.push(a)}),50*a);var i=10;for(a=0;a<i;a++){var s=new e.ParticleLine(this.body.position.x,this.body.position.y,1.5*Math.random()+1.5,400*Math.random()+100,360/i*a*radian,100*Math.random()+100,1.5,50,"#FFFF00");aUnderEffects.push(s)}for(i=25,a=0;a<i;a++){var r=new e.Particle(0,this.body.position.x,this.body.position.y,6*Math.random()+6,450*Math.random()+100,3*Math.random()+3,360*Math.random()*radian,100*Math.random()*100,!1);aUnderEffects.push(r)}if(0==this.playerType){for(a=0;a<aUserBodyParts.length;a++)aUserBodyParts[a]==this.body&&(aUserBodyParts.splice(a,1),a-=1),aUserBodyParts[a]==this.wheel0&&(aUserBodyParts.splice(a,1),a-=1),aUserBodyParts[a]==this.wheel1&&(aUserBodyParts.splice(a,1),a-=1),aUserBodyParts[a]==this.mace&&(aUserBodyParts.splice(a,1),a-=1);0==gameMode?userKilled():1!=gameMode||multiplayerLevelOver||(multiPlayerKilled(),lastPlayerWon=1)}else{for(a=0;a<aEnemyBodyParts.length;a++)aEnemyBodyParts[a]==this.body&&(aEnemyBodyParts.splice(a,1),a-=1),aEnemyBodyParts[a]==this.wheel0&&(aEnemyBodyParts.splice(a,1),a-=1),aEnemyBodyParts[a]==this.wheel1&&(aEnemyBodyParts.splice(a,1),a-=1),aEnemyBodyParts[a]==this.mace&&(aEnemyBodyParts.splice(a,1),a-=1);0==gameMode?enemyKilled():1!=gameMode||multiplayerLevelOver||(multiPlayerKilled(),lastPlayerWon=0)}Composite.remove(engine.world,this.composite),screenShake();for(a=0;a<this.aBodyParts.length;a++)this.aBodyParts[a].explodeInc=-(400*Math.random()+400),this.aBodyParts[a].explodeRot=20*Math.random()-10,this.aBodyParts[a].explodeIncX=1e3*Math.random()-500},t.prototype.swing=function(){if(this.swingState=1,playSound("swing"+Math.floor(5*Math.random()),.7),0==this.playerType){for(var e=0;e<aEnemies.length;e++)if(0==aEnemies[e].state){var t=this.body.position.x-aEnemies[e].body.position.x,a=this.body.position.y-aEnemies[e].body.position.y;Math.sqrt(t*t+a*a)<this.swingRange&&(this.enemyNearAngle=Math.atan2(a,t))}}else if(1==this.playerType)for(e=0;e<aUsers.length;e++)if(0==aUsers[e].state){t=this.body.position.x-aUsers[e].body.position.x,a=this.body.position.y-aUsers[e].body.position.y;Math.sqrt(t*t+a*a)<this.swingRange&&(this.enemyNearAngle=Math.atan2(a,t))}this.swingAngle=this.arm.angle,Matter.Body.getAngularVelocity(this.wheel0)>0?this.endSwingAngle=this.swingAngle+360*radian:this.endSwingAngle=this.swingAngle-360*radian,this.swingTimeInc=0;var i=Matter.Body.getVelocity(this.body);null==this.enemyNearAngle?Matter.Body.setVelocity(this.body,{x:1*i.x,y:1*this.jumpPower+1*i.y}):Matter.Body.setVelocity(this.body,{x:i.x-25*Math.cos(this.enemyNearAngle),y:i.y-25*Math.sin(this.enemyNearAngle)}),this.swingInc=this.swingRate},t.prototype.jump=function(){1==this.playerType?playSound("jump",.1):playSound("jump",.2);var t=Matter.Body.getVelocity(this.wheel0),a=Matter.Body.getVelocity(this.wheel1);Matter.Body.setVelocity(this.wheel0,{x:1*t.x,y:-this.jumpPower*(.2*Math.random()+.9)+1*t.y}),Matter.Body.setVelocity(this.wheel1,{x:1*a.x,y:-this.jumpPower*(.2*Math.random()+.9)+1*a.y}),this.jumpInc=this.jumpRate;for(var i=0;i<3;i++){var s=12*Math.random()+12,r=new e.Smoke(this.body.position.x+50*Math.random()-25,this.body.position.y+50*Math.random()-25,s,5);aOverEffects.push(r),this.trailInc=0}},t.prototype.bombExplode=function(t){if(0==this.state){var a=this.body.position.x-t.x,i=this.body.position.y-t.y,s=Math.sqrt(a*a+i*i);if(s<200){playSound("hit"+Math.floor(8*Math.random()),.5);var r=Math.round(100*((200-s)/200*1.5+.1*Math.random()))/100;this.energy-=r;Matter.Body.setAngularVelocity(this.body,2*Math.random()-1);var o=new e.TextFloat(this.body.position.x,this.body.position.y-50,Math.round(100*r).toString());aPickUps.push(o),this.hitFlashInc=.2,this.energy<=0&&this.destroy()}}},t.prototype.updateBase=function(){if(this.inc+=delta,this.hitRecoverInc>-1&&(this.hitRecoverInc-=delta,this.hitRecoverInc<=-1&&(this.hitRecoverInc=-1)),this.damageRecoverInc>0&&(this.damageRecoverInc-=delta,this.damageRecoverInc<=0&&(this.damageRecoverInc=0)),this.swingInc>0&&(this.swingInc-=delta,this.swingInc<=0&&(this.swingInc=0)),this.jumpInc>0&&(this.jumpInc-=delta,this.jumpInc<=0&&(this.jumpInc=0)),1==this.swingState){this.swingTimeInc+=delta;var t=this.swingAngle+easeOutCubic(this.swingTimeInc/this.swingDuration)*(this.endSwingAngle-this.swingAngle);Matter.Body.setAngle(this.arm,t,!0),this.swingTimeInc>=.5&&(this.swingState=0,Matter.Body.setAngle(this.arm,normalizeAngleRadian(this.arm.angle)))}else{this.arm.angle<-200*radian||this.arm.angle<160*radian&&this.arm.angle>0*radian?Matter.Body.setAngularVelocity(this.arm,.05):(this.arm.angle>200*radian||this.arm.angle>-160*radian&&this.arm.angle<0*radian)&&Matter.Body.setAngularVelocity(this.arm,-.05)}this.x=this.body.position.x,this.y=this.body.position.y;var a=Matter.Body.getVelocity(this.body),i={x:0,y:0,type:null};if(aPush.length>0&&(i=checkWind(this.body.position.x,this.body.position.y),this.newWind&&null!=i.type&&(0==i.type?playSound("wind",.4):1==i.type&&playSound("water"+Math.floor(3*Math.random()),.75),this.newWind=!1),Matter.Body.setVelocity(this.body,{x:a.x+140*i.x*delta,y:a.y+140*i.y*delta}),a=Matter.Body.getVelocity(this.body),this.newWind||null!=i.type||(this.newWind=!0)),this.wheelRot-=.1*(this.wheelRot-(this.moveLeft+this.moveRight)*this.speed*25*delta),this.moveLeft+this.moveRight!=0&&(Body.setAngularVelocity(this.wheel0,this.wheelRot),Body.setAngularVelocity(this.wheel1,this.wheelRot),this.moveLeft+this.moveRight==1?Matter.Body.setVelocity(this.body,{x:a.x+20*delta,y:a.y}):Matter.Body.setVelocity(this.body,{x:a.x-20*delta,y:a.y})),0==this.state&&(this.body.position.y>levelMaxY+300||this.body.position.y<levelMinY-800)&&this.destroy(),this.trailInc+=delta,this.trailInc>.02)if(0!=i.x||0!=i.y){r=0==this.state?5*Math.random()+5:15*Math.random()+15,1==this.state&&Math.random();var s=new e.Smoke(this.body.position.x+50*Math.random()-25,this.body.position.y+50*Math.random()-25,r,5);aOverEffects.push(s),this.trailInc=-.2}else if(this.smokeInc<.1&&this.body.speed>1||1==this.state){var r;r=0==this.state?15*Math.random()+5:15*Math.random()+15,1==this.state&&Math.random();s=new e.Smoke(this.body.position.x+30*Math.random()-15,this.body.position.y+30*Math.random()-15+10,r,5);aOverEffects.push(s),this.trailInc=0}this.smokeInc+=delta,this.groundContact?this.allowGroundSound&&(playSound("ground"+Math.floor(7*Math.random()),.4),this.allowGroundSound=!1):this.allowGroundSound=!0;for(var o=0;o<aTeleports.length;o++){var n=this.body.position.x-aTeleports[o].x,h=this.body.position.y-aTeleports[o].y,d=Math.sqrt(n*n+h*h);if(d<100&&this.nearTeleport!=o){if(0==this.playerType||1==gameMode){screenShake(),playSound("upgradeFull");for(var c=0;c<g;c++){var l=new e.ParticleLine(aTeleports[this.nearTeleport].x,aTeleports[this.nearTeleport].y,Math.random()*m+m,200*Math.random()+100,360/g*c*radian,20,1.5,50,aColours[Math.floor(Math.random()*aColours.length)]);aUnderEffects.push(l)}}else playSound("upgradeFull",.5);this.nearTeleport=(o+1)%2,Matter.Composite.translate(this.composite,{x:aTeleports[this.nearTeleport].x-this.body.position.x,y:aTeleports[this.nearTeleport].y-this.body.position.y}),scene.triggerTeleport(this.nearTeleport);var g=8,m=1}else d>200&&this.nearTeleport==o&&(this.nearTeleport=null)}},t.prototype.renderMarker=function(){var e=Math.atan2(cameraY+this.body.position.y*cameraScale-canvas.height/2,cameraX+this.body.position.x*cameraScale-canvas.width/2),t=getSpriteData(assetLib.getData("uiElements"),"distMarker");ctx.save(),ctx.translate(canvas.width/2+canvas.width/2*.92*Math.cos(e),canvas.height/2+canvas.height/2*.92*Math.sin(e)),ctx.rotate(e),ctx.drawImage(t.img,t.bX,t.bY,t.bWidth,t.bHeight,-t.bWidth/2,-t.bHeight/2,t.bWidth,t.bHeight),ctx.restore();t=getSpriteData(assetLib.getData("uiElements"),"truckMarker");ctx.drawImage(t.img,t.bX,t.bY,t.bWidth,t.bHeight,canvas.width/2+(canvas.width/2*.92-75)*Math.cos(e)-t.bWidth/2,canvas.height/2+(canvas.height/2*.92-75)*Math.sin(e)-t.bHeight/2,t.bWidth,t.bHeight)},t.prototype.savePos=function(){for(var e=0;e<this.aBodyParts.length;e++)this.aBodyParts[e].body.prevPosition=this.aBodyParts[e].body.position},t.prototype.render=function(){(1==this.playerType||0==this.playerType&&1==gameMode)&&0==this.state&&(cameraX+this.body.position.x*cameraScale>canvas.width+50||cameraX+this.body.position.x*cameraScale<-50||cameraY+this.body.position.y*cameraScale>canvas.height+50||cameraY+this.body.position.y*cameraScale<-50)&&this.renderMarker();var e,t,a,i=.5*cameraScale,s="";(this.hitFlashInc>0&&0==this.state||this.energy<=.3)&&(Math.sin(50*this.inc)>0&&(s="Hit"),this.hitFlashInc-=delta);for(var r=0;r<this.aBodyParts.length;r++){switch(t=this.chassisId.toString()+s,this.aBodyParts[r].asset){case"arm":e=this.maceId.toString()+s,a=this.aBodyParts[r].body.angle;break;case"body":e=this.bodyId.toString()+s,a=this.aBodyParts[r].body.angle;break;case"mace":e=this.maceId.toString()+s,a=this.aBodyParts[0].body.angle-180*radian;break;case"wheel":e=this.wheelId.toString()+s,a=this.aBodyParts[r].body.angle}1==this.state&&(this.aBodyParts[r].explodeInc+=1e3*delta,this.aBodyParts[r].body.position.y+=this.aBodyParts[r].explodeInc*delta,this.aBodyParts[r].body.angle+=this.aBodyParts[r].explodeRot*delta,this.aBodyParts[r].body.position.x+=this.aBodyParts[r].explodeIncX*delta),ctx.save(),o=getSpriteData(assetLib.getData("gameElements"),this.aBodyParts[r].asset+e),"body"==this.aBodyParts[r].asset?(ctx.translate(cameraX+this.aBodyParts[r].body.position.x*cameraScale,cameraY+this.aBodyParts[r].body.position.y*cameraScale-(10+10*(1-Math.abs(Math.sin(this.aBodyParts[r].body.angle))))*cameraScale),ctx.scale(.5*cameraScale,.5*cameraScale),ctx.rotate(a),ctx.drawImage(o.img,o.bX,o.bY,o.bWidth,o.bHeight,-o.bWidth/2,-o.bHeight/2,o.bWidth,o.bHeight),ctx.rotate(-a),ctx.scale(1/(.5*cameraScale),1/(.5*cameraScale)),ctx.translate(0,(10+10*(1-Math.abs(Math.sin(a))))*cameraScale),ctx.scale(.5*cameraScale,.5*cameraScale),ctx.rotate(a),o=getSpriteData(assetLib.getData("gameElements"),"chassis"+t),ctx.drawImage(o.img,o.bX,o.bY,o.bWidth,o.bHeight,-o.bWidth/2,-o.bHeight/2,o.bWidth,o.bHeight)):(ctx.translate(cameraX+this.aBodyParts[r].body.position.x*cameraScale,cameraY+this.aBodyParts[r].body.position.y*cameraScale),"wheel"==this.aBodyParts[r].asset?ctx.scale(.5*cameraScale*this["wheelScale"+this.aBodyParts[r].posId],.5*cameraScale*this["wheelScale"+this.aBodyParts[r].posId]):ctx.scale(.5*cameraScale,.5*cameraScale),ctx.rotate(a),ctx.drawImage(o.img,o.bX,o.bY,o.bWidth,o.bHeight,-o.bWidth/2,-o.bHeight/2,o.bWidth,o.bHeight)),ctx.restore()}if(0==this.state&&(this.energy>.3||Math.sin(20*this.inc)>0)){var o=getSpriteData(assetLib.getData("uiElements"),"marker"+this.playerType+"1");ctx.drawImage(o.img,o.bX,o.bY,o.bWidth,o.bHeight,cameraX+this.body.position.x*cameraScale-o.bWidth/2*i,cameraY+(this.body.position.y-100)*cameraScale-o.bHeight/2*i,o.bWidth*i,o.bHeight*i);var n=Math.max(this.energy,.001);o=getSpriteData(assetLib.getData("uiElements"),"marker"+this.playerType+"0");ctx.drawImage(o.img,o.bX,o.bY+o.bHeight*(1-n),o.bWidth,o.bHeight*n,cameraX+this.body.position.x*cameraScale-o.bWidth/2*i,cameraY+(this.body.position.y-100)*cameraScale-(o.bHeight/2-o.bHeight*(1-n))*i,o.bWidth*i,o.bHeight*i*n)}1==gameMode&&addText(0,30,175,"center",cameraX+this.body.position.x*cameraScale,cameraY+(this.body.position.y-120)*cameraScale,"pShort"+this.playerType,"#FFFFFF")},t}();e.Player=t}(Elements||(Elements={})),function(e){var t=function(e){function t(t,a){var i=e.call(this,t)||this;return i.multiPlayerId=a,0==i.multiPlayerId?(i.bodyId=saveDataHandler.getUpgrade0(),i.maceId=saveDataHandler.getUpgrade1(),i.chassisId=saveDataHandler.getUpgrade2(),i.wheelId=saveDataHandler.getUpgrade3(),i.playerType=0):(1==saveDataHandler.getUpgrade0()||3==saveDataHandler.getUpgrade0()?i.bodyId=2:i.bodyId=3,1==saveDataHandler.getUpgrade1()?i.maceId=0:i.maceId=1,1==saveDataHandler.getUpgrade2()?i.chassisId=0:i.chassisId=1,0==saveDataHandler.getUpgrade3()||1==saveDataHandler.getUpgrade3()?i.wheelId=5:i.wheelId=0,i.playerType=1),0==gameMode?(i.hitDamage=.2+saveDataHandler.getUpgrade1()*aUpgrades[1].perc/100,i.jumpPower+=saveDataHandler.getUpgrade2()*aUpgrades[1].perc/100*12,i.speed=.4+saveDataHandler.getUpgrade3()*aUpgrades[1].perc/100):(i.hitDamage=.2,i.speed=.4),i.swingRate=.35,i.swingRange=200,i.createMatter(),i}return __extends(t,e),t.prototype.update=function(){if(1==this.moveDown&&this.swingInc<=0&&this.swing(),this.enemyNearAngle=null,1==gameMode&&0==this.playerType&&0==this.state&&(multiplayerIsClose=!1,0==enemy.state)){var e=this.body.position.x-enemy.body.position.x,t=this.body.position.y-enemy.body.position.y;Math.sqrt(e*e+t*t)<this.swingRange&&(multiplayerIsClose=!0)}this.updateBase()},t}(e.Player);e.User=t}(Elements||(Elements={})),function(e){var t=function(e){function t(t){var a=e.call(this,t)||this;return a.swingDelayInc=0,a.swingDelay=0,a.aiState=0,a.randomJumpInc=0,a.forceDirection=0,a.directionChangeInc=0,a.aWheelSize=new Array([1,1],[.9,.8],[1.1,1.1],[1,1.2],[.8,.8],[.8,1.1],[1,1.1],[1.2,.8],[.9,.8],[1,.9],[1.1,1.1]),a.curEnemyZone=null,a.enemyZoneInc=0,a.targX=0,a.playerType=1,a.hitDamage=.05+Math.min(.15,.004*curLevel),a.swingRate=1,a.swingDelayInc=a.swingDelay=.5,a.swingRange=200,a.speed=Math.random()*Math.min(curLevel/20,.2)+.1,a.energy=0==curLevel?.5:1,a.setEnemyDress(),a.wheelScale0=1,a.wheelScale1=1,a.createMatter(),a}return __extends(t,e),t.prototype.setEnemyDress=function(){for(Math.seedrandom(curLevel+enemyInc+5),enemyInc++,this.bodyId=Math.floor(10*Math.random());this.bodyId==saveDataHandler.getUpgrade0();)this.bodyId=Math.floor(10*Math.random());for(this.maceId=Math.floor(10*Math.random());this.maceId==saveDataHandler.getUpgrade1();)this.maceId=Math.floor(10*Math.random());for(this.chassisId=Math.floor(10*Math.random());this.chassisId==saveDataHandler.getUpgrade2();)this.chassisId=Math.floor(10*Math.random());for(this.wheelId=Math.floor(10*Math.random());this.wheelId==saveDataHandler.getUpgrade3();)this.wheelId=Math.floor(10*Math.random())},t.prototype.targetReachable=function(e){return e.body.position.y>this.body.position.y-300||e.body.position.y<this.body.position.y+300},t.prototype.update=function(){if(0==this.state){for(var e=null,t=null,a=0;a<aUsers.length;a++)if(0==aUsers[a].state){var i=this.body.position.x-aUsers[a].body.position.x,s=this.body.position.y-aUsers[a].body.position.y,r=Math.sqrt(i*i+s*s);(null==e||r<t)&&(t=r,e=aUsers[a])}if(null!=e&&t<this.swingRange&&curLevel>=2?this.swingDelayInc<=0&&this.swingInc<=0&&this.hitRecoverInc<=-.5?this.swing():this.swingDelayInc-=delta:this.swingDelayInc=this.swingDelay,this.energy<.2&&(this.aiState=3),(this.body.position.x<levelMinX+150||this.body.position.x>levelMaxX-150)&&(this.aiState=4),this.aiState=null==e||0==curLevel?1:0,aEnemyZones.length>0){var o=!1,n=this.body.position.x,h=this.body.position.y;for(a=0;a<aEnemyZones.length;a++)n>aEnemyZones[a].x-aEnemyZones[a].w/2&&n<aEnemyZones[a].x+aEnemyZones[a].w/2&&h>aEnemyZones[a].y-aEnemyZones[a].h/2&&h<aEnemyZones[a].y+aEnemyZones[a].h/2&&(o=!0,this.curEnemyZone=a,this.enemyZoneInc=3);!o&&null!=this.curEnemyZone&&this.enemyZoneInc>=0?(this.enemyZoneInc-=delta,this.aiState=5,this.targX=aEnemyZones[this.curEnemyZone].x):null!=e&&(this.aiState=0)}switch(this.aiState){case 0:e.body.position.x>this.body.position.x?(this.moveLeft=0,this.moveRight=1):e.body.position.x<this.body.position.x&&(this.moveLeft=-1,this.moveRight=0);break;case 1:this.moveLeft=0,this.moveRight=0;break;case 2:1==this.forceDirection?(this.moveLeft=0,this.moveRight=1):(this.moveLeft=-1,this.moveRight=0),this.directionChangeInc-=delta,this.directionChangeInc<=0&&(this.directionChangeInc=3*Math.random()+2,this.targetReachable(e)?0==this.forceDirection?this.forceDirection=1:this.forceDirection=0:this.aiState=0);break;case 3:e.body.position.x<this.body.position.x?(this.moveLeft=0,this.moveRight=1):e.body.position.x>this.body.position.x&&(this.moveLeft=-1,this.moveRight=0);break;case 4:this.body.position.x<0?(this.moveLeft=0,this.moveRight=1):this.body.position.x>0&&(this.moveLeft=-1,this.moveRight=0);case 5:this.body.position.x<this.targX?(this.moveLeft=0,this.moveRight=1):this.body.position.x>this.targX&&(this.moveLeft=-1,this.moveRight=0)}null!=e&&this.randomJumpInc<=0&&this.jumpInc<=0&&!e.body.position.y<this.body.position.y&&curLevel>=2&&(this.jump(),this.randomJumpInc=2*Math.random()+1),this.randomJumpInc-=delta}this.updateBase()},t}(e.Player);e.Enemy=t}(Elements||(Elements={})),function(e){var t=function(){function e(e,t,a,i){void 0===a&&(a=1),void 0===i&&(i=0),this.x=0,this.y=0,this.radius=0,this.startRadius=0,this.removeMe=!1,this.inc=0,this.aLines=new Array,this.x=e,this.y=t,this.radius=this.startRadius=1.5*a,this.ringScale=0,this.endRingScale=2*a,this.type=i,this.time=1,this.offsetX=10*Math.random()-5,this.offsetY=10*Math.random()-5;var s=360*Math.random();this.aLines=new Array;for(var r=0;r<2;r++)this.aLines.push((s+90*r)*radian)}return e.prototype.update=function(){this.inc+=delta,this.radius=this.startRadius+easeOutCubic(this.inc/this.time)*(0-this.startRadius),this.ringScale=easeOutCubic(this.inc/this.time)*this.endRingScale,this.inc>=this.time&&(this.removeMe=!0)},e.prototype.render=function(){if(this.radius>0)if(0==this.type){ctx.strokeStyle="#FE4E00",ctx.lineWidth=.5*this.radius*cameraScale*1.8*3,ctx.beginPath(),ctx.arc(cameraX+this.x*cameraScale,cameraY+this.y*cameraScale,.8*Math.max(this.ringScale*cameraScale,.01),0,2*Math.PI),ctx.stroke(),ctx.strokeStyle="#FFA800",ctx.lineWidth=.5*this.radius*cameraScale*1.4*3,ctx.beginPath(),ctx.arc(cameraX+(this.x+this.offsetX)*cameraScale,cameraY+(this.y+this.offsetY)*cameraScale,.8*Math.max((this.ringScale-.5*this.radius*1.4)*cameraScale,.01),0,2*Math.PI),ctx.stroke(),ctx.strokeStyle="#FEFC00",ctx.lineWidth=.5*this.radius*cameraScale*3,ctx.beginPath(),ctx.arc(cameraX+(this.x+2*this.offsetX)*cameraScale,cameraY+(this.y+2*this.offsetY)*cameraScale,.8*Math.max((this.ringScale-.5*this.radius*1.8)*cameraScale,.01),0,2*Math.PI),ctx.stroke(),ctx.strokeStyle="#FFFFFF",ctx.lineWidth=.1*this.radius*cameraScale,ctx.lineCap="round",ctx.fillStyle="#FFFFFF",ctx.beginPath(),ctx.arc(cameraX+this.x*cameraScale,cameraY+this.y*cameraScale,this.radius*cameraScale*2,0,2*Math.PI),ctx.fill();for(var e=0;e<this.aLines.length;e++)ctx.beginPath(),ctx.moveTo(cameraX+(this.x+this.radius*Math.cos(this.aLines[e])*2.5)*cameraScale,cameraY+(this.y+this.radius*Math.sin(this.aLines[e])*2.5)*cameraScale),ctx.lineTo(cameraX+(this.x+this.radius*Math.cos(this.aLines[e]+180*radian)*2.5)*cameraScale,cameraY+(this.y+this.radius*Math.sin(this.aLines[e]+180*radian)*2.5)*cameraScale),ctx.stroke()}else if(1==this.type){ctx.fillStyle="#FFFFFF",ctx.beginPath(),ctx.arc(cameraX+this.x*cameraScale,cameraY+this.y*cameraScale,this.radius*cameraScale,0,2*Math.PI),ctx.fill(),ctx.strokeStyle="#FFFFFF",ctx.lineWidth=.5*this.radius*cameraScale,ctx.beginPath(),ctx.arc(cameraX+(this.x+2*this.offsetX)*cameraScale,cameraY+(this.y+2*this.offsetY)*cameraScale,Math.max((this.ringScale-.5*this.radius*1.8)*cameraScale,.01),0,2*Math.PI),ctx.stroke(),ctx.strokeStyle="#FFFFFF",ctx.lineWidth=.1*this.radius*cameraScale,ctx.lineCap="round";for(e=0;e<this.aLines.length;e++)ctx.beginPath(),ctx.moveTo(cameraX+(this.x+this.radius*Math.cos(this.aLines[e])*2.5)*cameraScale,cameraY+(this.y+this.radius*Math.sin(this.aLines[e])*2.5)*cameraScale),ctx.lineTo(cameraX+(this.x+this.radius*Math.cos(this.aLines[e]+180*radian)*2.5)*cameraScale,cameraY+(this.y+this.radius*Math.sin(this.aLines[e]+180*radian)*2.5)*cameraScale),ctx.stroke()}},e}();e.Pop=t}(Elements||(Elements={})),function(e){var t=function(t){function a(){var e=t.call(this,assetLib.getData("coin"),40,25,"spin")||this;return e.fixX=0,e.fixY=0,e.collectRange=70,e.removeMe=!1,e.state=0,e.type="coin",e.frameInc=Math.floor(18*Math.random()),e}return __extends(a,t),a.prototype.collect=function(){var t=this;this.state=1;var a=new e.Pop(this.fixX,this.fixY,50,1);aUnderEffects.push(a),this.scaleX=this.scaleY=1,TweenLite.to(this,.5,{x:canvas.width-100,y:canvas.height-30,ease:"Back.easeIn",onComplete:function(){curCoins++,t.removeMe=!0}})},a.prototype.update=function(){if(t.prototype.updateAnimation.call(this),0==this.state){this.x=cameraX+this.fixX*cameraScale,this.y=cameraY+this.fixY*cameraScale,this.scaleX=this.scaleY=.5*cameraScale;var e=this.fixX-user.body.position.x,a=this.fixY-user.body.position.y;Math.sqrt(e*e+a*a)<this.collectRange&&this.collect()}else this.state},a.prototype.render=function(){t.prototype.renderSimple.call(this)},a}(Utils.AnimSprite);e.Coin=t}(Elements||(Elements={})),function(e){var t=function(){function e(e,t,a,i,s,r,o,n,h){void 0===r&&(r=10),void 0===o&&(o=1),void 0===n&&(n=0),void 0===h&&(h=null),this.effectType=1,this.inc=0,this.col="#FFFFFF",this.removeMe=!1,this.startScale=this.scale=-a/2,this.endScale=a,this.angle=s,this.startX=this.x=e-n*Math.cos(s),this.startY=this.y=t-n*Math.sin(s),this.endX=this.x-i*Math.cos(s),this.endY=this.y-i*Math.sin(s),this.lineLength=r,null!=h&&(this.col=h),this.time=o+Math.random()*o}return e.prototype.update=function(){this.inc+=delta,this.scale=this.startScale+easeOutCubic(this.inc/this.time)*(this.endScale-this.startScale),this.x=this.startX+easeOutCubic(this.inc/this.time)*(this.endX-this.startX),this.y=this.startY+easeOutCubic(this.inc/this.time)*(this.endY-this.startY),this.inc>=this.time&&(this.removeMe=!0)},e.prototype.render=function(){var e=10*(this.endScale-Math.abs(this.scale));if(e>0){var t=this.x-this.lineLength*(this.endScale-Math.abs(this.scale))*Math.cos(this.angle),a=this.y-this.lineLength*(this.endScale-Math.abs(this.scale))*Math.sin(this.angle);ctx.strokeStyle=this.col,ctx.lineWidth=e*cameraScale,ctx.lineCap="round",ctx.beginPath(),ctx.moveTo(cameraX+this.x*cameraScale,cameraY+this.y*cameraScale),ctx.lineTo(cameraX+t*cameraScale,cameraY+a*cameraScale),ctx.stroke()}},e}();e.ParticleLine=t}(Elements||(Elements={})),function(e){var t=function(){function e(e,t,a,i,s,r,o,n,h){void 0===e&&(e=0),void 0===i&&(i=1),void 0===s&&(s=0),void 0===r&&(r=1),void 0===o&&(o=360*Math.random()*radian),void 0===n&&(n=0),void 0===h&&(h=!1),this.x=0,this.y=0,this.inc=0,this.removeMe=!1,this.time=0,this.ranNum=10*Math.random(),this.radius=0,this.maxRadius=i,this.dir=o,this.speed=s,this.time=r,this.flashId=h?Math.floor(Math.random()*aColours.length):null,this.x=t+n*Math.cos(this.dir),this.y=a+n*Math.sin(this.dir),this.colour=e}return e.prototype.update=function(){this.inc+=delta,this.radius=this.maxRadius+easeInCubic(this.inc/this.time)*(0-this.maxRadius),this.x+=this.speed*this.radius*.1*Math.cos(this.dir)*delta,this.y+=this.speed*this.radius*.1*Math.sin(this.dir)*delta,this.inc>=this.time&&(this.removeMe=!0)},e.prototype.render=function(){this.radius>0&&(ctx.beginPath(),ctx.arc(cameraX+this.x*cameraScale,cameraY+this.y*cameraScale,this.radius*cameraScale,0,2*Math.PI),null!=this.flashId&&Math.sin(20*this.inc+this.ranNum)>0?ctx.fillStyle=aColours[this.flashId]:ctx.fillStyle="#FFFFFF",ctx.fill())},e}();e.Particle=t}(Elements||(Elements={})),function(e){var t=function(){function e(e,t,a,i,s,r){void 0===a&&(a=1),void 0===i&&(i=0),void 0===s&&(s=360*Math.random()*radian),void 0===r&&(r=0),this.x=0,this.y=0,this.inc=0,this.removeMe=!1,this.state=0,this.expandTime=.1,this.time=1,this.radius=0,this.maxRadius=a,this.dir=s,this.speed=i*(.9*Math.random()+.1)*10,this.x=e+r*Math.cos(this.dir),this.y=t+r*Math.sin(this.dir)}return e.prototype.update=function(){this.inc+=delta,0==this.state?(this.radius=easeOutCubic(this.inc/this.expandTime)*this.maxRadius,this.inc>=this.expandTime&&(this.state=1)):(this.radius=this.maxRadius+easeInCubic(this.inc/this.time)*(0-this.maxRadius),this.x+=this.speed*this.radius*.1*Math.cos(this.dir)*delta,this.y+=this.speed*this.radius*.1*Math.sin(this.dir)*delta,this.inc>=this.time&&(this.removeMe=!0))},e.prototype.render=function(){this.radius>0&&(ctx.beginPath(),ctx.arc(cameraX+this.x*cameraScale,cameraY+this.y*cameraScale,this.radius*cameraScale,0,2*Math.PI),ctx.fillStyle="#C6BFA4",ctx.fill(),ctx.beginPath(),ctx.arc(cameraX+this.x*cameraScale,cameraY+(this.y-.5*this.radius)*cameraScale,this.radius*cameraScale,0,2*Math.PI),ctx.fillStyle="#E5DFC7",ctx.fill())},e}();e.Smoke=t}(Elements||(Elements={})),function(e){var t=function(){function t(e,t){this.state=0,this.blowInc=0,this.removeMe=!1,this.tickInc=0,this.type="bomb",this.nearTeleport=null,this.tickRate=.5,this.createMatter(e,t)}return t.prototype.createMatter=function(e,t){this.body=Bodies.rectangle(e,t,45,35,{friction:.01}),hasGravity||(this.body.frictionAir=0,Matter.Body.setAngularVelocity(this.body,.04*Math.random()-.02),Matter.Body.setVelocity(this.body,{x:4*Math.random()-2,y:4*Math.random()-2})),Matter.Body.setMass(this.body,this.body.mass/2),Composite.add(engine.world,this.body)},t.prototype.update=function(){if(0==this.state){var e=Query.collides(this.body,aUserBodyParts),t=Query.collides(this.body,aEnemyBodyParts);(e.length>0||t.length>0)&&(this.state=1)}else if(1==this.state&&(this.blowInc+=delta,this.blowInc>this.tickInc&&(playSound("bombTick",.3),this.tickInc+=this.tickRate,this.tickRate=Math.max(this.tickRate-.05,.1)),this.blowInc>=3)){this.state=2;for(var a=0;a<aUsers.length;a++)aUsers[a].bombExplode(this.body.position);for(a=0;a<aEnemies.length;a++)aEnemies[a].bombExplode(this.body.position);scene.bombExplode(this.body.position),playSound("explode"+Math.floor(2*Math.random()),1),Composite.remove(engine.world,this.body),this.destroy(),this.removeMe=!0}if(aPush.length>0){var i=checkWind(this.body.position.x,this.body.position.y),s=Matter.Body.getVelocity(this.body);Matter.Body.setVelocity(this.body,{x:s.x+75*i.x*delta,y:s.y+75*i.y*delta})}checkTeleport(this)},t.prototype.destroy=function(){var t=this;screenShake();for(var a=0;a<3;a++)setTimeout((function(){var a=new e.Pop(t.body.position.x+100*Math.random()-50,t.body.position.y+100*Math.random()-50,50*Math.random()+50);aUnderEffects.push(a)}),100*a);var i=Math.floor(5*Math.random()+5);for(a=0;a<i;a++){var s=new e.ParticleLine(this.body.position.x,this.body.position.y,1.5*Math.random()+1.5,200*Math.random()+100,360/i*a,20,1.5,50,"#FFFF00");aUnderEffects.push(s)}for(i=Math.floor(5*Math.random()+10),a=0;a<i;a++){var r=new e.Particle(0,this.body.position.x,this.body.position.y,6*Math.random()+6,450*Math.random()+100,1.5*Math.random()+1.5,360*Math.random()*radian,100,!1);aUnderEffects.push(r)}},t.prototype.render=function(){if(this.state<2){ctx.save();var e=0;1==this.state&&Math.sin(50*this.blowInc)>0&&(e=1);var t=getSpriteData(assetLib.getData("gameElements"),"bomb"+e);ctx.translate(cameraX+this.body.position.x*cameraScale,cameraY+this.body.position.y*cameraScale),ctx.scale(.5*cameraScale,.5*cameraScale),ctx.rotate(this.body.angle),ctx.drawImage(t.img,t.bX,t.bY,t.bWidth,t.bHeight,-t.bWidth/2+10,-t.bHeight/2,t.bWidth,t.bHeight),ctx.restore()}},t}();e.Bomb=t}(Elements||(Elements={})),function(e){var t=function(){function t(e,t,a){this.fixX=0,this.fixY=0,this.collectRange=70,this.removeMe=!1,this.state=0,this.scale=0,this.resetInc=0,this.inc=10*Math.random(),this.type="health",this.id=a,this.fixX=e,this.fixY=t,this.triggerAppear()}return t.prototype.triggerAppear=function(){this.scale=0,this.state=0,this.resetInc=0,TweenLite.to(this,.5,{scale:1,ease:"Cubic.easeOut",onComplete:function(){}})},t.prototype.collect=function(t){var a=this;this.state=1,playSound("coin"+Math.floor(3*Math.random()),.35);var i=new e.Pop(this.fixX,this.fixY,50,1);aUnderEffects.push(i),"health"==this.id?t.energy=1:"cog"==this.id&&curCogs++,this.scale=1,TweenLite.to(this,.5,{x:canvas.width/2,y:canvas.height,ease:"Back.easeIn",onComplete:function(){"health"==a.id?a.state=2:a.removeMe=!0}})},t.prototype.update=function(){if(this.inc+=delta,0==this.state){this.x=cameraX+this.fixX*cameraScale,this.y=cameraY+this.fixY*cameraScale;var e=this.fixX-user.body.position.x,t=this.fixY-user.body.position.y,a=Math.sqrt(e*e+t*t);a<this.collectRange&&this.collect(user),1==gameMode&&"health"==this.id&&(e=this.fixX-enemy.body.position.x,t=this.fixY-enemy.body.position.y,(a=Math.sqrt(e*e+t*t))<this.collectRange&&this.collect(enemy))}else 2==this.state&&(this.resetInc+=delta,this.resetInc>=5&&this.triggerAppear())},t.prototype.render=function(){if(this.state<2){var e,t=getSpriteData(assetLib.getData("gameElements"),this.id);e=0==this.state?this.scale*cameraScale*.5:this.scale,ctx.drawImage(t.img,t.bX,t.bY,t.bWidth,t.bHeight,this.x-t.bWidth/2*e,this.y-t.bHeight/2*e-Math.abs(25*Math.sin(5*this.inc)),t.bWidth*e,t.bHeight*e)}},t}();e.Health=t}(Elements||(Elements={})),function(e){var t=function(){function e(e,t,a,i){void 0===i&&(i="rgba(255, 0, 0, 0.8)"),this.x=0,this.y=0,this.inc=0,this.removeMe=!1,this.time=0,this.time=1,this.text=a,this.x=e,this.y=this.startY=t,this.scale=1,this.colour=i}return e.prototype.update=function(){this.inc+=delta,this.scale=1+-1*easeInCubic(this.inc/this.time),this.y=this.startY+-100*easeOutCubic(this.inc/this.time),this.inc>=this.time&&(this.removeMe=!0)},e.prototype.render=function(){this.removeMe||addDirectText(0,65*this.scale*cameraScale,canvas.width/2,"center",cameraX+this.x*cameraScale,cameraY+this.y*cameraScale,this.text,this.colour)},e}();e.TextFloat=t}(Elements||(Elements={})),function(e){var t=function(){function e(e,t,a){this.state=0,this.removeMe=!1,this.type="beachBall",this.nearTeleport=null,this.createMatter(e,t),this.id=a}return e.prototype.createMatter=function(e,t){this.body=Bodies.circle(e,t,51.75,{frictionAir:0,friction:.01}),hasGravity||(this.body.frictionAir=0,Matter.Body.setAngularVelocity(this.body,.04*Math.random()-.02),Matter.Body.setVelocity(this.body,{x:4*Math.random()-2,y:4*Math.random()-2})),Matter.Body.setMass(this.body,this.body.mass/10),Composite.add(engine.world,this.body)},e.prototype.update=function(){if(aPush.length>0){var e=checkWind(this.body.position.x,this.body.position.y),t=Matter.Body.getVelocity(this.body);Matter.Body.setVelocity(this.body,{x:t.x+150*e.x*delta,y:t.y+150*e.y*delta})}checkTeleport(this)},e.prototype.render=function(){ctx.save();var e=getSpriteData(assetLib.getData("gameElements"),"beachBall"+this.id);ctx.translate(cameraX+this.body.position.x*cameraScale,cameraY+this.body.position.y*cameraScale),ctx.scale(.5*cameraScale,.5*cameraScale),ctx.rotate(this.body.angle),ctx.drawImage(e.img,e.bX,e.bY,e.bWidth,e.bHeight,-e.bWidth/2,-e.bHeight/2,e.bWidth,e.bHeight),ctx.restore()},e}();e.BeachBall=t}(Elements||(Elements={})),function(e){var t=function(){function e(e,t,a){this.state=0,this.removeMe=!1,this.dir=0,this.spinRate=.1,this.type="sawBlade",this.nearTeleport=null,this.createMatter(e,t),this.dir=a}return e.prototype.createMatter=function(e,t){this.body=Bodies.circle(e,t,43.25,{friction:1}),hasGravity||(this.body.frictionAir=0,Matter.Body.setVelocity(this.body,{x:4*Math.random()-2,y:4*Math.random()-2})),Composite.add(engine.world,this.body)},e.prototype.update=function(){if(0==this.dir?Body.setAngularVelocity(this.body,this.spinRate):1==this.dir&&Body.setAngularVelocity(this.body,-this.spinRate),aPush.length>0){var e=checkWind(this.body.position.x,this.body.position.y),t=Matter.Body.getVelocity(this.body);Matter.Body.setVelocity(this.body,{x:t.x+40*e.x*delta,y:t.y+40*e.y*delta})}checkTeleport(this)},e.prototype.render=function(){ctx.save();var e=getSpriteData(assetLib.getData("gameElements"),"sawBlade");ctx.translate(cameraX+this.body.position.x*cameraScale,cameraY+this.body.position.y*cameraScale),ctx.scale(.5*cameraScale,.5*cameraScale),ctx.rotate(this.body.angle),ctx.drawImage(e.img,e.bX,e.bY,e.bWidth,e.bHeight,-e.bWidth/2,-e.bHeight/2,e.bWidth,e.bHeight),ctx.restore()},e}();e.SawBlade=t}(Elements||(Elements={})),function(e){var t=function(){function e(e,t){this.state=0,this.removeMe=!1,this.type="rock",this.nearTeleport=null,this.createMatter(e,t)}return e.prototype.createMatter=function(e,t){this.body=Bodies.circle(e,t,95,{friction:1}),hasGravity||(this.body.frictionAir=0,Matter.Body.setAngularVelocity(this.body,.04*Math.random()-.02),Matter.Body.setVelocity(this.body,{x:4*Math.random()-2,y:4*Math.random()-2})),Matter.Body.setMass(this.body,5*this.body.mass),Composite.add(engine.world,this.body)},e.prototype.update=function(){if(aPush.length>0){var e=checkWind(this.body.position.x,this.body.position.y),t=Matter.Body.getVelocity(this.body);Matter.Body.setVelocity(this.body,{x:t.x+10*e.x*delta,y:t.y+10*e.y*delta})}checkTeleport(this)},e.prototype.render=function(){ctx.save();var e=getSpriteData(assetLib.getData("gameElements"),"rock");ctx.translate(cameraX+this.body.position.x*cameraScale,cameraY+this.body.position.y*cameraScale),ctx.scale(.5*cameraScale,.5*cameraScale),ctx.rotate(this.body.angle),ctx.drawImage(e.img,e.bX,e.bY,e.bWidth,e.bHeight,-e.bWidth/2,-e.bHeight/2,e.bWidth,e.bHeight),ctx.restore()},e}();e.Rock=t}(Elements||(Elements={})),function(e){var t=function(){function e(e){this.dataGroupNum=2,this.addedIndex=56,this.saveDataId=e;var t,a="test",i=!1;try{t=window.localStorage,i=!0}catch(e){console.log("local storage denied"),i=!1,this.canStore=!1}if(i)try{t.setItem(a,"1"),t.removeItem(a),this.canStore=!0}catch(e){this.canStore=!1}this.clearData(),this.setInitialData()}return e.prototype.clearData=function(){this.aLevelStore=new Array,this.aLevelStore.push(0),this.aLevelStore.push(0),this.aLevelStore.push(0),this.aLevelStore.push(0),this.aLevelStore.push(0),this.aLevelStore.push(0),this.aLevelStore.push(0);for(var e=0;e<50;e++)this.aLevelStore.push(0)},e.prototype.resetData=function(){this.clearData(),this.saveData()},e.prototype.setInitialData=function(){if(this.canStore&&"undefined"!=typeof Storage)if(null!=localStorage.getItem(this.saveDataId)&&""!=localStorage.getItem(this.saveDataId))for(var e in this.aLevelStore=localStorage.getItem(this.saveDataId).split(","),this.aLevelStore)this.aLevelStore[e]=parseInt(this.aLevelStore[e]);else this.saveData()},e.prototype.upgradesLeft=function(){return this.aLevelStore[2]<9||(this.aLevelStore[3]<9||(this.aLevelStore[4]<9||this.aLevelStore[5]<9))},e.prototype.getUpgradeCogs=function(){return this.aLevelStore[1]},e.prototype.setUpgradeCogs=function(e){this.aLevelStore[1]=e,this.saveData()},e.prototype.getP1Level=function(){return this.aLevelStore[0]},e.prototype.setP1Level=function(e){this.aLevelStore[0]=e,this.saveData()},e.prototype.getP2Level=function(){return this.aLevelStore[6]},e.prototype.setP2Level=function(e){this.aLevelStore[6]=e,this.saveData()},e.prototype.getUpgrade0=function(){return this.aLevelStore[2]},e.prototype.addUpgrade0=function(){this.aLevelStore[2]++,this.saveData()},e.prototype.getUpgrade1=function(){return this.aLevelStore[3]},e.prototype.addUpgrade1=function(){this.aLevelStore[3]++,this.saveData()},e.prototype.getUpgrade2=function(){return this.aLevelStore[4]},e.prototype.addUpgrade2=function(){this.aLevelStore[4]++,this.saveData()},e.prototype.getUpgrade3=function(){return this.aLevelStore[5]},e.prototype.addUpgrade3=function(){this.aLevelStore[5]++,this.saveData()},e.prototype.saveData=function(){if(this.canStore&&"undefined"!=typeof Storage){for(var e="",t=0;t<this.aLevelStore.length;t++)e+=this.aLevelStore[t],t<this.aLevelStore.length-1&&(e+=",");localStorage.setItem(this.saveDataId,e)}},e}();e.SaveDataHandler=t}(Utils||(Utils={}));var previousTime,canvasX,canvasY,sound,music,assetLib,preAssetLib,fpsTween,curSoundLoop,_this_1=this,requestAnimFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.requestAnimationFrame||function(e){window.setTimeout(e,1e3/60,(new Date).getTime())},canvas=document.getElementById("canvas"),ctx=canvas.getContext("2d"),maxWidth=850,minWidth=850,maxHeight=850,minHeight=850,canvasScale=1,isRotated=!1,div=document.getElementById("canvas-wrapper"),assetIdInc=0,audioType=0,muted=!1,splashTimer=0,isMobile=!1,gameState="loading",aLangs=new Array("EN"),curLang="",isBugBrowser=!1,isIE10=!1,radian=Math.PI/180,fps=1,ios9FirstTouch=!1,hasFocus=!0,saveDataHandler=new Utils.SaveDataHandler("truckslamv2");navigator.userAgent.match(/MSIE\s([\d]+)/)&&(isIE10=!0);var deviceAgent=navigator.userAgent.toLowerCase();(deviceAgent.match(/(iphone|ipod|ipad)/)||deviceAgent.match(/(android)/)||deviceAgent.match(/(iemobile)/)||deviceAgent.match(/iphone/i)||deviceAgent.match(/ipad/i)||deviceAgent.match(/ipod/i)||deviceAgent.match(/blackberry/i)||deviceAgent.match(/bada/i)||"MacIntel"===navigator.platform&&navigator.maxTouchPoints>1)&&(isMobile=!0,deviceAgent.match(/(android)/)&&!/Chrome/.test(navigator.userAgent)&&(isBugBrowser=!0));var userInput=new Utils.UserInput(canvas,isBugBrowser);function visibleResume(){hasFocus||(userInput&&userInput.checkKeyFocus(),"suspended"==Howler.ctx.state&&Howler.ctx.resume(),muted||"pause"==gameState||"splash"==gameState||"loading"==gameState||(Howler.mute(!1),playMusic())),hasFocus=!0}function visiblePause(){hasFocus=!1,Howler.mute(!0),music.pause()}function playMusic(){music.playing()||music.play()}function isStock(){var e=window.navigator.userAgent.match(/Android.*AppleWebKit\/([\d.]+)/);return e&&parseFloat(e[1])<537}resizeCanvas(),window.onresize=function(){setTimeout((function(){resizeCanvas()}),1)},window.onpageshow=function(){hasFocus||(userInput&&userInput.checkKeyFocus(),muted||"pause"==gameState||"splash"==gameState||"loading"==gameState||(Howler.mute(!1),playMusic())),hasFocus=!0},window.onpagehide=function(){hasFocus=!1,Howler.mute(!0),music.pause()},window.addEventListener("load",(function(){setTimeout((function(){resizeCanvas()}),0),window.addEventListener("orientationchange",(function(){setTimeout((function(){resizeCanvas()}),500),setTimeout((function(){resizeCanvas()}),2e3)}),!1)}));var panel,background,ua=navigator.userAgent,isSharpStock=/SHL24|SH-01F/i.test(ua)&&isStock(),isXperiaAStock=/SO-04E/i.test(ua)&&isStock(),isFujitsuStock=/F-01F/i.test(ua)&&isStock();isIE10||isSharpStock||isXperiaAStock||isFujitsuStock||void 0===window.AudioContext&&void 0===window.webkitAudioContext&&-1!=navigator.userAgent.indexOf("Android")?audioType=0:(audioType=1,sound=new Howl({src:["audio/sound.mp3"],sprite:{silence:[0,502.87981859410434],click:[1500,48.934240362811686],gameLose:[3e3,1029.501133786848],gameStart:[5500,1651.5192743764171],gameWin:[8e3,2298.0952380952376],healthAlert:[11500,232.13151927437713],hit0:[13e3,770.2721088435371],hit1:[14500,521.0884353741499],hit2:[16e3,619.4104308390038],hit3:[17500,799.6371882086173],hit4:[19e3,976.0997732426304],hit5:[20500,1028.7981859410422],hit6:[23e3,1041.6326530612246],hit7:[25500,1259.183673469387],sloMoExplode0:[28e3,2868.8888888888896],sloMoExplode1:[31500,2429.2970521541974],ground0:[35e3,478.57142857142776],ground1:[36500,419.27437641723486],ground2:[38e3,224.76190476190538],ground3:[39500,252.8798185941028],ground4:[41e3,126.43990929705495],ground5:[42500,433.718820861678],ground6:[44e3,238.5487528344683],gemTweenOut:[45500,1856.530612244896],swing0:[48e3,499.20634920634654],swing1:[49500,499.34240362811977],swing2:[51e3,498.27664399092697],swing3:[52500,499.9773242630354],swing4:[54e3,500.56689342403615],explode0:[55500,539.1609977324237],explode1:[57e3,441.36054421768733],bombTick:[58500,46.417233560092086],jump:[6e4,441.17913832199207],upgradeBut:[61500,1141.4058956916122],upgradeSweep:[64e3,1260.7029478458003],upgradeFull:[66500,1441.088435374155],upgradeReward:[69e3,1468.662131519281],coin0:[71500,1279.1156462585036],coin1:[74e3,856.1451247165479],coin2:[75500,1087.6870748299298],wind:[78e3,1888.8435374149708],water0:[80500,1602.1768707482947],water1:[83e3,1447.0068027210914],water2:[85500,1440.226757369615]}}),music=new Howl({src:["audio/music.mp3"],volume:0,loop:!0}));var aEnemyZones,aEnemyPortals,panelFrame,oLogoBut,musicTween,scene,user,enemy,aEnemies,aUsers,portalEnemies,aUpgradeOffer,oExitPortal,aEnemyBodyParts,aUserBodyParts,aTeleports,aUnderEffects,aOverEffects,aPush,aScenery,aPickUps,oMobileControls,delta,totalScore=0,levelScore=0,curLevel=0,aTutorials=new Array,hasGravity=!0,oLogoData={},oImageIds={},lastPlayerWon=0,p1Score=0,p2Score=0,oJoystick0={x:200,y:-200,dirX:0,dirY:0,radius0:125,radius1:50,isDown:!1,identifier:null,hyp:0,aimAngle:0},oJoystick1={x:200,y:-200,dirX:0,dirY:0,radius0:125,radius1:50,isDown:!1,identifier:null,hyp:0,aimAngle:0},curCoins=0,enemyInc=0,curCogs=0,multiplayerLevelOver=!1,multiplayerHasHit=!1,multiplayerIsClose=!1,aUpgrades=new Array({perc:5,id:0},{perc:5,id:1},{perc:5,id:2},{perc:5,id:3}),p2LevelIndexStart=42,Engine=Matter.Engine,Body=Matter.Body,Bodies=Matter.Bodies,Runner=Matter.Runner,runner=Runner.create(),Composite=Matter.Composite,Constraint=Matter.Constraint,Query=Matter.Query,engine=Engine.create(),levelMinX=null,levelMaxX=null,levelMaxY=null,levelMinY=null,upgradeCogCount=0,Vertices=Matter.Vertices,screenX=0,screenY=0,cameraX=0,cameraY=0,cameraScale=1,maxCameraScale=1.5,gameMode=0,accumulator=0,accuAlpha=0,showTut0=!0,showTut1=!0,aRepeatLevels=new Array,aColours=new Array("#00e9b2","#00ddd9","#00d2f5","#0bc4ff","#7ab2ff","#8babff","#a4a3ff","#c098ff","#e085ff","#ff70fd","#ff6dd4","#ff70b1","#ff7092","#ff6e71","#fc7954","#ff874c","#ff9644","#ffa53c","#ffb434","#ffc42e","#e4d026","#c5da2e","#a3e342","#7bea5c","#42f079","#42f079");function loadLang(e){if(void 0===e&&(e="en"),null!=e)curLang=e;else{var t=new window.URLSearchParams(window.location.search);curLang=t.get("lang"),console.log(curLang)}(curLang=e)&&null!=curLang&&null!=curLang||(curLang="en"),loadPreAssets()}function initSplash(){window.PokiSDK.gameLoadingFinished(),gameState="splash","ar"==curLang&&(document.body.style.direction="rtl"),resizeCanvas(),aRepeatLevels=new Array;for(var e=3;e<p2LevelIndexStart;e++)aRepeatLevels.push(e);curLevel=saveDataHandler.getP1Level(),Runner.run(runner,engine),runner.delta=1e3/30,runner.maxFrameTime=100,1!=audioType||muted||(playMusic(),hasFocus||music.pause()),p1Score=p2Score=0,initStartScreen()}function addMuteBut(e){if(1==audioType){var t=oImageIds.muteBut0,a=oImageIds.muteBut0Over;muted&&(t=oImageIds.muteBut1,a=oImageIds.muteBut1Over);var i={oImgData:assetLib.getData("uiButs"),aPos:[-60,60],align:[1,0],id:t,idOver:a};userInput.addHitArea("mute",butEventHandler,null,"image",i);for(var s=0;s<e.length;s++)if(e[s].id==oImageIds.muteBut0||e[s].id==oImageIds.muteBut1)return;e.push(i)}}function initCreditsScreen(){gameState="credits";var e={oImgData:assetLib.getData("uiButs"),aPos:[60,-60],align:[0,1],id:oImageIds.backBut,idOver:oImageIds.backButOver},t={oImgData:assetLib.getData("uiButs"),aPos:[-60,-60],align:[1,1],id:oImageIds.resetBut,idOver:oImageIds.resetButOver};userInput.addHitArea("backFromCredits",butEventHandler,null,"image",e),userInput.addHitArea("resetData",butEventHandler,null,"image",t);var a=new Array(e,t);addMuteBut(a),(panel=new Elements.Panel(gameState,a)).startTween1(),previousTime=(new Date).getTime(),updateCreditsScreenEvent()}function initResetConfirmScreen(){gameState="resetConfirm";var e={oImgData:assetLib.getData("uiButs"),aPos:[-130,120],align:[.5,.5],id:oImageIds.yesBut,idOver:oImageIds.yesButOver},t={oImgData:assetLib.getData("uiButs"),aPos:[130,120],align:[.5,.5],id:oImageIds.quitBut,idOver:oImageIds.quitButOver};userInput.addHitArea("yesFromResetConfirm",butEventHandler,null,"image",e),userInput.addHitArea("noFromResetConfirm",butEventHandler,null,"image",t);var a=new Array(e,t);addMuteBut(a),(panel=new Elements.Panel(gameState,a)).startTween1(),previousTime=(new Date).getTime(),updateResetConfirmEvent()}function initStartScreen(){gameState="start",1==audioType&&music.fade(music.volume(),.1,500),background=new Elements.Background;var e=new Array;generateLevel(),accumulator=0,aUnderEffects=new Array,aOverEffects=new Array,addMuteBut(e),(panel=new Elements.Panel(gameState,e)).startTween1(),setTimeout((function(){runner.enabled=!1,previousTime=(new Date).getTime(),updateStartScreenEvent()}),100),cameraX=canvas.width/2,cameraY=canvas.height/2,cameraScale=2;var t={oImgData:assetLib.getData("uiButs"),aPos:[0,50],align:[.5,.7],id:oImageIds.playBut,idOver:oImageIds.playBut,flash:!0};userInput.addHitArea("p1FromStart",butEventHandler,null,"image",t),panel.aButs.push(t);var a={oImgData:assetLib.getData("uiButs"),aPos:[100,-132],align:[0,1],scale:.6,id:oImageIds.p2But,idOver:oImageIds.p2ButOver};userInput.addHitArea("p2FromStart",butEventHandler,null,"image",a),panel.aButs.push(a);var i={oImgData:assetLib.getData("uiButs"),aPos:[-165,60],align:[1,0],id:oImageIds.infoBut,idOver:oImageIds.infoButOver,flash:!1};userInput.addHitArea("infoFromStart",butEventHandler,null,"image",i),panel.aButs.push(i)}function initNextP1Level(){upgradeCogCount=saveDataHandler.getUpgradeCogs(),curLevel=saveDataHandler.getP1Level(),generateLevel(),startGameplay()}function startGameplay(){1==audioType&&music.fade(music.volume(),.25,500),background=new Elements.Background,gameState="game",aUnderEffects=new Array,aOverEffects=new Array,runner.enabled=!0,curCogs=0,playSound("gameStart"),isMobile&&addMobileControls(),addGameControlKeys(),addMuteBut(panel.aButs),addPauseBut(),multiplayerLevelOver=!1,isMobile||(0==gameMode&&showTut0&&0==curLevel?(panel.tweenTut(),showTut0=!1):(1==gameMode&&showTut1||curLevel==p2LevelIndexStart)&&(panel.tweenTut(),showTut1=!1)),panel.startTween1(),window.PokiSDK.gameplayStart()}function addPauseBut(){var e={oImgData:assetLib.getData("uiButs"),aPos:[-165,60],align:[1,0],id:oImageIds.pauseBut,idOver:oImageIds.pauseButOver,flash:!1};userInput.addHitArea("pause",butEventHandler,null,"image",e),panel.aButs.push(e)}function removePauseBut(){userInput.removeHitArea("pause")}function initPause(){gameState="pause",window.PokiSDK.gameplayStop();var e={oImgData:assetLib.getData("uiButs"),aPos:[-250,0],align:[.5,.5],id:oImageIds.continueBut,idOver:oImageIds.continueButOver},t={oImgData:assetLib.getData("uiButs"),aPos:[0,0],align:[.5,.5],id:oImageIds.replayBut,idOver:oImageIds.replayButOver},a={oImgData:assetLib.getData("uiButs"),aPos:[250,0],align:[.5,.5],id:oImageIds.quitBut,idOver:oImageIds.quitButOver};userInput.addHitArea("playFromPause",butEventHandler,null,"image",e),userInput.addHitArea("restartFromPause",butEventHandler,null,"image",t),userInput.addHitArea("quitFromPause",butEventHandler,null,"image",a);var i=new Array(e,t,a);(panel=new Elements.Panel(gameState,i)).startTween1(),previousTime=(new Date).getTime(),updatePauseEvent()}function resumeGame(){gameState="game";var e=new Array;addMuteBut(e),isMobile&&addMobileControls(),addGameControlKeys(),panel=new Elements.Panel(gameState,e),addPauseBut(),panel.startTween1(),runner.enabled=!0}function restartLevel(){gameState="game";var e=new Array;addMuteBut(e),isMobile&&addMobileControls(),addGameControlKeys(),panel=new Elements.Panel(gameState,e),addPauseBut(),panel.startTween1(),runner.enabled=!0,generateLevel(),multiplayerLevelOver=!1}function initLevelSuccess(){gameState="levelSuccess",1==audioType&&music.fade(music.volume(),.1,500),window.PokiSDK.gameplayStop(),saveDataHandler.setP1Level(curLevel+1),(upgradeCogCount=saveDataHandler.getUpgradeCogs())+curCogs>=10?saveDataHandler.setUpgradeCogs(upgradeCogCount+curCogs-10):saveDataHandler.setUpgradeCogs(upgradeCogCount+curCogs),runner.enabled=!1,aUnderEffects=new Array,aOverEffects=new Array,removeGameControlKeys(),removeMobileControls();var e=new Array;(panel=new Elements.Panel(gameState,e)).tweenLevelSuccess(),previousTime=(new Date).getTime(),updateLevelSuccessEvent()}function initLevelSuccessButs(){panel.startTween1(),panel.butDisplayState=1;var e={oImgData:assetLib.getData("uiButs"),aPos:[0,50],align:[.5,.7],id:oImageIds.playBut,idOver:oImageIds.playButOver,flash:!0};userInput.addHitArea("playFromLevelSuccess",butEventHandler,null,"image",e),panel.aButs.push(e),userInput.addKey("playFromLevelSuccessKey",butEventHandler,null,13),userInput.addKey("playFromLevelSuccessKey",butEventHandler,null,32)}function initUpgradeScreen(){gameState="upgradeScreen",aUnderEffects=new Array,aOverEffects=new Array;var e,t,a,i=new Array;addMuteBut(i),setUpgradeOffer();for(var s=0;s<aUpgradeOffer.length;s++){e=4==aUpgradeOffer[s],4==aUpgradeOffer.length||3==aUpgradeOffer.length&&s<2?(t=s%2*320-160,a=280*Math.floor(s/2)-140):3==aUpgradeOffer.length?(t=0,a=280*Math.floor(s/2)-140):1==aUpgradeOffer.length&&(t=0,a=0);var r={oImgData:assetLib.getData("uiButs"),aPos:[t,a],align:[.5,.55],id:oImageIds["upgradeBut"+aUpgradeOffer[s]],idOver:oImageIds["upgradeBut"+aUpgradeOffer[s]+"Over"],flash:e};userInput.addHitArea("chooseFromUpgrade",butEventHandler,{id:aUpgradeOffer[s]},"image",r),i.push(r)}(panel=new Elements.Panel(gameState,i)).startTween1(),previousTime=(new Date).getTime(),updateUpgradeScreenEvent()}function initMultiplayerLevelEnd(){gameState="multiplayerLevelEnd",1==audioType&&music.fade(music.volume(),.1,500),window.PokiSDK.gameplayStop(),aUnderEffects=new Array,aOverEffects=new Array,0==lastPlayerWon?p1Score++:p2Score++,removeGameControlKeys(),removeMobileControls();var e=new Array;(panel=new Elements.Panel(gameState,e)).tweenMultiplayerLeveEnd(),previousTime=(new Date).getTime(),updateMultiplayerLevelEndEvent()}function initLevelFail(){gameState="levelFail",aUnderEffects=new Array,aOverEffects=new Array,window.PokiSDK.gameplayStop(),removeGameControlKeys(),removeMobileControls();var e=new Array,t={oImgData:assetLib.getData("uiButs"),aPos:[0,50],align:[.5,.7],id:oImageIds.replayBut,idOver:oImageIds.replayButOver,flash:!0};userInput.addHitArea("playFromLevelFail",butEventHandler,null,"image",t),e.push(t),userInput.addKey("playFromLevelFailKey",butEventHandler,null,13),userInput.addKey("playFromLevelFailKey",butEventHandler,null,32),(panel=new Elements.Panel(gameState,e)).startTween1(),previousTime=(new Date).getTime(),updateLevelFailEvent()}function butEventHandler(e,t){switch(e){case"langSelect":curLang=t.lang,ctx.clearRect(0,0,canvas.width,canvas.height),userInput.removeHitArea("langSelect"),(preAssetLib=new Utils.AssetLoader(curLang,[{id:"preloadImage",file:"images/preloadImage.jpg"}],ctx,canvas.width,canvas.height,!1)).onReady(initLoadAssets);break;case"infoFromStart":playSound("click"),userInput.removeHitArea("p1FromStart"),userInput.removeHitArea("infoFromStart"),userInput.removeHitArea("p2FromStart"),userInput.removeKey("p1FromStart"),initCreditsScreen();break;case"p1FromStart":playSound("click"),gameMode=0,userInput.removeHitArea("p1FromStart"),userInput.removeHitArea("infoFromStart"),userInput.removeHitArea("p2FromStart"),userInput.removeKey("p1FromStart"),panel.removeBut(oImageIds.p1But),panel.removeBut(oImageIds.playBut),panel.removeBut(oImageIds.p2But),panel.removeBut(oImageIds.infoBut),curLevel=saveDataHandler.getP1Level(),generateLevel(),startGameplay();break;case"p2FromStart":playSound("click"),userInput.removeHitArea("p1FromStart"),userInput.removeHitArea("infoFromStart"),userInput.removeHitArea("p2FromStart"),userInput.removeKey("p1FromStart"),panel.removeBut(oImageIds.playBut),panel.removeBut(oImageIds.p1But),panel.removeBut(oImageIds.p2But),panel.removeBut(oImageIds.infoBut),gameMode=1,curLevel=saveDataHandler.getP2Level()+p2LevelIndexStart,generateLevel(),startGameplay();break;case"backFromCredits":playSound("click"),userInput.removeHitArea("backFromCredits"),userInput.removeHitArea("resetData"),userInput.removeHitArea("mute"),initStartScreen(),runner.enabled=!0;break;case"resetData":playSound("click"),userInput.removeHitArea("backFromCredits"),userInput.removeHitArea("resetData"),userInput.removeHitArea("mute"),initResetConfirmScreen();break;case"yesFromResetConfirm":playSound("click"),userInput.removeHitArea("yesFromResetConfirm"),userInput.removeHitArea("noFromResetConfirm"),userInput.removeHitArea("mute"),saveDataHandler.resetData(),showTut0=!0,showTut1=!0,enemyInc=0,curLevel=saveDataHandler.getP1Level(),upgradeCogCount=saveDataHandler.getUpgradeCogs(),initStartScreen(),runner.enabled=!0;break;case"noFromResetConfirm":playSound("click"),userInput.removeHitArea("yesFromResetConfirm"),userInput.removeHitArea("noFromResetConfirm"),userInput.removeHitArea("mute"),initCreditsScreen();break;case"chooseFromUpgrade":playSound("click"),userInput.removeHitArea("chooseFromUpgrade"),panel.removeBut(oImageIds.upgradeBut0),panel.removeBut(oImageIds.upgradeBut1),panel.removeBut(oImageIds.upgradeBut2),panel.removeBut(oImageIds.upgradeBut3),panel.removeBut(oImageIds.upgradeBut4),4==t.id?showRewardAd():(setTimeout((function(){playSound("upgradeBut",1)}),500),saveDataHandler["addUpgrade"+t.id](),showAd((function(){initNextP1Level()})));break;case"moveRight":case"rightTouch":0==gameMode||1==gameMode&&0==t.keyId?t.isDown?(user.moveRight=1,user.moveLeft=0):user.moveRight=0:1==gameMode&&1==t.keyId&&(t.isDown?(enemy.moveRight=1,enemy.moveLeft=0):enemy.moveRight=0);break;case"moveLeft":case"leftTouch":0==gameMode||1==gameMode&&0==t.keyId?t.isDown?(user.moveLeft=-1,user.moveRight=0):user.moveLeft=0:1==gameMode&&1==t.keyId&&(t.isDown?(enemy.moveLeft=-1,enemy.moveRight=0):enemy.moveLeft=0);break;case"moveUp":case"jumpTouch":0==gameMode||1==gameMode&&0==t.keyId?t.isDown?user.jumpInc<=0&&0==user.moveUp&&(user.jump(),user.moveUp=1):user.moveUp=0:1==gameMode&&1==t.keyId&&(t.isDown?enemy.jumpInc<=0&&0==enemy.moveUp&&(enemy.jump(),enemy.moveUp=1):enemy.moveUp=0);break;case"moveDown":case"swingTouch":0==gameMode||1==gameMode&&0==t.keyId?t.isDown?0==user.moveDown&&user.swingInc<=0&&(user.swing(),user.moveDown=1):user.moveDown=0:1==gameMode&&1==t.keyId&&(t.isDown?0==enemy.moveDown&&enemy.swingInc<=0&&(enemy.swing(),enemy.moveDown=1):enemy.moveDown=0);break;case"mute":playSound("click"),toggleMute(),muted?panel.switchBut(oImageIds.muteBut0,oImageIds.muteBut1,oImageIds.muteBut1Over):panel.switchBut(oImageIds.muteBut1,oImageIds.muteBut0,oImageIds.muteBut0Over);break;case"pause":playSound("click"),1==audioType?(Howler.mute(!0),music.pause()):2==audioType&&music.pause(),removePauseBut(),removeGameControlKeys(),removeMobileControls(),userInput.removeHitArea("mute"),runner.enabled=!1,initPause();break;case"playFromPause":playSound("click"),1==audioType?muted||(Howler.mute(!1),playMusic()):2==audioType&&(muted||playMusic()),userInput.removeHitArea("playFromPause"),userInput.removeHitArea("restartFromPause"),userInput.removeHitArea("quitFromPause"),userInput.removeHitArea("mute"),resumeGame();break;case"quitFromPause":playSound("click"),1==audioType?muted||(Howler.mute(!1),playMusic()):2==audioType&&(muted||playMusic()),userInput.removeHitArea("playFromPause"),userInput.removeHitArea("restartFromPause"),userInput.removeHitArea("quitFromPause"),userInput.removeHitArea("mute"),initStartScreen(),runner.enabled=!0;break;case"restartFromPause":playSound("click"),1==audioType?muted||(Howler.mute(!1),playMusic()):2==audioType&&(muted||playMusic()),userInput.removeHitArea("playFromPause"),userInput.removeHitArea("restartFromPause"),userInput.removeHitArea("quitFromPause"),userInput.removeHitArea("mute"),restartLevel()}}function addMobileControls(){var e=93*(oMobileControls={gameMode0:{left0:{x:120,y:Math.min(.85*canvas.height-50,canvas.height-250)},right0:{x:320,y:Math.min(.85*canvas.height,canvas.height-200)},swing0:{x:canvas.width-320,y:Math.min(.85*canvas.height,canvas.height-200)},jump0:{x:canvas.width-120,y:Math.min(.85*canvas.height-50,canvas.height-250)},scale:1},gameMode1:{left0:{x:250,y:canvas.height-100},right0:{x:400,y:canvas.height-100},swing0:{x:100,y:canvas.height-100},jump0:{x:100,y:canvas.height-250},left1:{x:canvas.width-400,y:canvas.height-100},right1:{x:canvas.width-250,y:canvas.height-100},swing1:{x:canvas.width-100,y:canvas.height-100},jump1:{x:canvas.width-100,y:canvas.height-250},scale:.75}})["gameMode"+gameMode].scale,t=1;1==gameMode&&(t=2);for(var a=0;a<t;a++)userInput.addHitArea("leftTouch",butEventHandler,{isDraggable:!0,multiTouch:!0,keyId:a},"rect",{aRect:[oMobileControls["gameMode"+gameMode]["left"+a].x-e,oMobileControls["gameMode"+gameMode]["left"+a].y-e,oMobileControls["gameMode"+gameMode]["left"+a].x+e,oMobileControls["gameMode"+gameMode]["left"+a].y+e]},!1),userInput.addHitArea("rightTouch",butEventHandler,{isDraggable:!0,multiTouch:!0,keyId:a},"rect",{aRect:[oMobileControls["gameMode"+gameMode]["right"+a].x-e,oMobileControls["gameMode"+gameMode]["right"+a].y-e,oMobileControls["gameMode"+gameMode]["right"+a].x+e,oMobileControls["gameMode"+gameMode]["right"+a].y+e]},!1),userInput.addHitArea("swingTouch",butEventHandler,{isDraggable:!0,multiTouch:!0,keyId:a},"rect",{aRect:[oMobileControls["gameMode"+gameMode]["swing"+a].x-e,oMobileControls["gameMode"+gameMode]["swing"+a].y-e,oMobileControls["gameMode"+gameMode]["swing"+a].x+e,oMobileControls["gameMode"+gameMode]["swing"+a].y+e]},!1),userInput.addHitArea("jumpTouch",butEventHandler,{isDraggable:!0,multiTouch:!0,keyId:a},"rect",{aRect:[oMobileControls["gameMode"+gameMode]["jump"+a].x-e,oMobileControls["gameMode"+gameMode]["jump"+a].y-e,oMobileControls["gameMode"+gameMode]["jump"+a].x+e,oMobileControls["gameMode"+gameMode]["jump"+a].y+e]},!1)}function removeMobileControls(){userInput.removeHitArea("leftTouc0"),userInput.removeHitArea("rightTouch"),userInput.removeHitArea("jumpTouch"),userInput.removeHitArea("swingTouch")}function addGameControlKeys(){userInput.addKey("moveRight",butEventHandler,{keyId:1},39),userInput.addKey("moveRight",butEventHandler,{keyId:0},68),userInput.addKey("moveLeft",butEventHandler,{keyId:1},37),userInput.addKey("moveLeft",butEventHandler,{keyId:0},65),userInput.addKey("moveUp",butEventHandler,{keyId:0},81),userInput.addKey("moveUp",butEventHandler,{keyId:1},38),userInput.addKey("moveUp",butEventHandler,{keyId:0},87),userInput.addKey("moveUp",butEventHandler,{keyId:0},90),userInput.addKey("moveDown",butEventHandler,{keyId:1},40),userInput.addKey("moveDown",butEventHandler,{keyId:0},83),0==gameMode&&(userInput.addKey("moveDown",butEventHandler,{keyId:0},32),userInput.addKey("moveDown",butEventHandler,{keyId:1},13))}function removeGameControlKeys(){userInput.removeKey("moveRight"),userInput.removeKey("moveLeft"),userInput.removeKey("moveUp"),userInput.removeKey("moveDown")}function enemyKilled(){var e=!0;if(aEnemyPortals.length>0){e=!1,enemy=new Elements.Enemy({x:aEnemyPortals[0].x,y:aEnemyPortals[0].y,id:aEnemies.length});var t=new Elements.Pop(aEnemyPortals[0].x,aEnemyPortals[0].y,75);aUnderEffects.push(t),aEnemies.push(enemy),aEnemyPortals.shift()}else for(var a=0;a<aEnemies.length;a++)0==aEnemies[a].state&&(e=!1);e&&(setTimeout((function(){playSound("gameWin")}),600),setTimeout((function(){removePauseBut(),initLevelSuccess()}),1e3)),playSound("sloMoExplode"+Math.floor(2*Math.random()),.6)}function userKilled(){playSound("gameLose"),playSound("sloMoExplode"+Math.floor(2*Math.random()),.6),removePauseBut(),setTimeout((function(){generateLevel(),addPauseBut()}),1e3)}function multiPlayerKilled(){playSound("gameWin"),playSound("sloMoExplode"+Math.floor(2*Math.random()),.6),multiplayerLevelOver=!0,removePauseBut(),setTimeout((function(){initMultiplayerLevelEnd()}),1e3)}function generateLevel(){oExitPortal={x:null,y:null,state:0},curCogs=0,Composite.clear(engine.world),aEnemyBodyParts=new Array,aUserBodyParts=new Array,aEnemies=new Array,aUsers=new Array,aPickUps=new Array,aPush=new Array,aScenery=new Array,aEnemyZones=new Array,aEnemyPortals=new Array,aTeleports=new Array;var e,t=new Array,a=curLevel,i=1;0==gameMode&&curLevel>=p2LevelIndexStart&&(a=aRepeatLevels[(curLevel-p2LevelIndexStart)%aRepeatLevels.length],i=Math.floor((curLevel-p2LevelIndexStart)/aRepeatLevels.length)%2),0==i&&(i=-1),hasGravity=!0;for(var s=0;s<aRawLevelData[a].length;s++)"space"==aRawLevelData[a][s].id&&(hasGravity=!1);engine.gravity.scale=hasGravity?7e-4:0;for(s=0;s<aRawLevelData[a%aRawLevelData.length].length;s++)if("p"==aRawLevelData[a][s].id){for(var r=!0,o=0;o<t.length;o++)t[o].oId==aRawLevelData[a][s].oId&&(r=!1);r&&t.push({oId:aRawLevelData[a][s].oId,aPoints:[],aBasicPoints:[],state:aRawLevelData[a][s].s})}levelMaxX=null,levelMinX=null,levelMaxY=null,levelMinY=null;for(s=0;s<aRawLevelData[a].length;s++)if("p"==aRawLevelData[a][s].id)for(o=0;o<t.length;o++)aRawLevelData[a][s].oId==t[o].oId&&t[o].aPoints.push({pId:aRawLevelData[a][s].pId,x:aRawLevelData[a][s].x*i,y:aRawLevelData[a][s].y}),(null==levelMinY||aRawLevelData[a][s].y<levelMinY)&&(levelMinY=aRawLevelData[a][s].y),(null==levelMaxY||aRawLevelData[a][s].y>levelMaxY)&&(levelMaxY=aRawLevelData[a][s].y),(null==levelMinX||aRawLevelData[a][s].x*i<levelMinX)&&(levelMinX=aRawLevelData[a][s].x*i),(null==levelMaxX||aRawLevelData[a][s].x*i>levelMaxX)&&(levelMaxX=aRawLevelData[a][s].x*i);else if("user"==aRawLevelData[a][s].id)user=new Elements.User({x:aRawLevelData[a][s].x*i,y:aRawLevelData[a][s].y,id:aUsers.length},0),aUsers.push(user);else if("enemy"==aRawLevelData[a][s].id)enemy=0==gameMode?new Elements.Enemy({x:aRawLevelData[a][s].x*i,y:aRawLevelData[a][s].y,id:aEnemies.length}):new Elements.User({x:aRawLevelData[a][s].x*i,y:aRawLevelData[a][s].y,id:aEnemies.length},1),aEnemies.push(enemy);else if("coin"==aRawLevelData[a][s].id){var n=new Elements.Coin;n.fixX=aRawLevelData[a][s].x*i,n.fixY=aRawLevelData[a][s].y,aPickUps.push(n)}else if("cog"==aRawLevelData[a][s].id){var h=new Elements.Health(aRawLevelData[a][s].x*i,aRawLevelData[a][s].y,"cog");aPickUps.push(h)}else if("bomb"==aRawLevelData[a][s].id){var d=new Elements.Bomb(aRawLevelData[a][s].x*i,aRawLevelData[a][s].y);aPickUps.push(d)}else if("beachBall"==aRawLevelData[a][s].id){var c=new Elements.BeachBall(aRawLevelData[a][s].x*i,aRawLevelData[a][s].y,aPickUps.length%2);aPickUps.push(c)}else if("sawBlade"==aRawLevelData[a][s].id){var l=new Elements.SawBlade(aRawLevelData[a][s].x*i,aRawLevelData[a][s].y,aRawLevelData[a][s].s);aPickUps.push(l)}else if("rock"==aRawLevelData[a][s].id){var g=new Elements.Rock(aRawLevelData[a][s].x*i,aRawLevelData[a][s].y);aPickUps.push(g)}else if("health"==aRawLevelData[a][s].id){var m=new Elements.Health(aRawLevelData[a][s].x*i,aRawLevelData[a][s].y,"health");aPickUps.push(m)}else"push"==aRawLevelData[a][s].id?(e={id:aRawLevelData[a][s].id,s:aRawLevelData[a][s].s,x:aRawLevelData[a][s].x*i,y:aRawLevelData[a][s].y,w:aRawLevelData[a][s].w,h:aRawLevelData[a][s].h,vx:aRawLevelData[a][s].vx*i,vy:aRawLevelData[a][s].vy},aPush.push(e)):"enemyZone"==aRawLevelData[a][s].id?(e={id:aRawLevelData[a][s].id,x:aRawLevelData[a][s].x*i,y:aRawLevelData[a][s].y,w:aRawLevelData[a][s].w,h:aRawLevelData[a][s].h},aEnemyZones.push(e)):"scenery"==aRawLevelData[a][s].id?(e={id:aRawLevelData[a][s].id,x:aRawLevelData[a][s].x*i,y:aRawLevelData[a][s].y},aScenery.push(e)):"enemyPortal"==aRawLevelData[a][s].id?(e={id:aRawLevelData[a][s].id,pId:aRawLevelData[a][s].pId,x:aRawLevelData[a][s].x*i,y:aRawLevelData[a][s].y},aEnemyPortals.push(e)):"exit"==aRawLevelData[a][s].id?(oExitPortal.x=aRawLevelData[a][s].x*i,oExitPortal.y=aRawLevelData[a][s].y):"teleport"==aRawLevelData[a][s].id&&(e={id:aRawLevelData[a][s].id,x:aRawLevelData[a][s].x*i,y:aRawLevelData[a][s].y},aTeleports.push(e));for(s=0;s<t.length;s++){t[s].aPoints=sortBy(t[s].aPoints,"pId"),t[s].centerPoint=getCenterPoint(t[s].aPoints);for(o=0;o<t[s].aPoints.length;o++)t[s].aBasicPoints[o]=[t[s].aPoints[o].x,t[s].aPoints[o].y]}scene=new Elements.Scene(t)}function checkTeleport(e){for(var t=0;t<aTeleports.length;t++){var a=e.body.position.x-aTeleports[t].x,i=e.body.position.y-aTeleports[t].y,s=Math.sqrt(a*a+i*i);if(s<100&&e.nearTeleport!=t){playSound("upgradeFull",.5),e.nearTeleport=(t+1)%2,Matter.Body.translate(e.body,{x:aTeleports[e.nearTeleport].x-e.body.position.x,y:aTeleports[e.nearTeleport].y-e.body.position.y}),scene.triggerTeleport(e.nearTeleport)}else s>200&&e.nearTeleport==t&&(e.nearTeleport=null)}}function checkWind(e,t){for(var a={x:0,y:0,type:null},i=0;i<aPush.length;i++)e>aPush[i].x-aPush[i].w/2&&e<aPush[i].x+aPush[i].w/2&&t>aPush[i].y-aPush[i].h/2&&t<aPush[i].y+aPush[i].h/2&&(a.x=aPush[i].vx,a.y=aPush[i].vy,a.type=aPush[i].s);return a}function limitMaxSpeedBody(e){var t=25,a=.1;e.velocity.x>t&&Matter.Body.setVelocity(e,{x:e.velocity.x-(e.velocity.x-t)*a,y:e.velocity.y*(t/e.velocity.x)}),e.velocity.x<-25&&Matter.Body.setVelocity(e,{x:e.velocity.x-(e.velocity.x+t)*a,y:e.velocity.y*(-25/e.velocity.x)}),e.velocity.y>t&&Matter.Body.setVelocity(e,{x:e.velocity.x*(t/e.velocity.y),y:e.velocity.y-(e.velocity.y-t)*a}),e.velocity.y<-25&&Matter.Body.setVelocity(e,{x:-e.velocity.x*(-25/e.velocity.y),y:e.velocity.y-(e.velocity.y+t)*a})}function getCoinWin(){return 10}function checkCollisions(){if(0==gameMode||1==gameMode){for(var e=0;e<aUsers.length;e++){var t=Query.collides(aUsers[e].mace,aEnemyBodyParts);t.length>0&&t.forEach((function(t){var a=t.bodyA===aUsers[e].mace?t.bodyB:t.bodyA;1==aUsers[e].swingState&&aEnemies[a.label].hitPart(a,aUsers[e])}));var a=Query.collides(aUsers[e].wheel0,scene.aMatters),i=Query.collides(aUsers[e].wheel0,scene.aMatters);a.length>0||i.length>0?(aUsers[e].smokeInc=0,aUsers[e].groundContact=!0):aUsers[e].groundContact=!1}for(e=0;e<aEnemies.length;e++){if(0==aEnemies[e].state){var s=Query.collides(aEnemies[e].mace,aUserBodyParts);s.length>0&&s.forEach((function(t){var a=t.bodyA===aEnemies[e].mace?t.bodyB:t.bodyA;1==aEnemies[e].swingState&&aUsers[a.label].hitPart(a,aEnemies[e])}))}a=Query.collides(aEnemies[e].wheel0,scene.aMatters),i=Query.collides(aEnemies[e].wheel0,scene.aMatters);(a.length>0||i.length>0)&&(aEnemies[e].smokeInc=0)}for(e=0;e<aPickUps.length;e++)if("sawBlade"==aPickUps[e].type){var r=Query.collides(aPickUps[e].body,aEnemyBodyParts);r.length>0&&r.forEach((function(t){var a=t.bodyA===aPickUps[e].body?t.bodyB:t.bodyA;aEnemies[a.label].damage(a,aPickUps[e].body,.05)})),(r=Query.collides(aPickUps[e].body,aUserBodyParts)).length>0&&r.forEach((function(t){var a=t.bodyA===aPickUps[e].body?t.bodyB:t.bodyA;aUsers[a.label].damage(a,aPickUps[e].body,.05)}))}}updateActionRender()}function setUpgradeOffer(){aUpgradeOffer=new Array;for(var e=0;e<aUpgrades.length;e++)saveDataHandler["getUpgrade"+e]()<9&&aUpgradeOffer.push(e);4==(aUpgradeOffer=shuffleArray(aUpgradeOffer)).length&&aUpgradeOffer.pop(),aUpgradeOffer.length>1&&aUpgradeOffer.push(4)}function screenShake(){screenY=400,TweenLite.to(this,1,{screenY:0,ease:"Elastic.easeOut"})}function shuffleArray(e){for(var t,a=e.length-1;a>0;a--){var i=Math.floor(Math.random()*(a+1));t=[e[i],e[a]],e[a]=t[0],e[i]=t[1]}return e}function easeOutCubic(e){return 1-Math.pow(1-e,3)}function easeInCubic(e){return e*e*e}function easeOutQuad(e){return 1-(1-e)*(1-e)}function easeOutExpo(e){return 1===e?1:1-Math.pow(2,-10*e)}function getCenterPoint(e){for(var t=null,a=null,i=null,s=null,r=0;r<e.length;r++)(null==t||e[r].x<t)&&(t=e[r].x),(null==a||e[r].x>a)&&(a=e[r].x),(null==i||e[r].y<i)&&(i=e[r].y),(null==s||e[r].y>s)&&(s=e[r].y);return{x:(a-t)/2+t,y:(s-i)/2+i}}function updateScore(e){levelScore+=e}function slowMo(){var e=this;fpsTween&&fpsTween.kill(),fps=1,fpsTween=TweenLite.to(this,.1,{fps:.5,delay:.2,ease:"Cubic.easeOut",onComplete:function(){fpsTween=TweenLite.to(e,.1,{fps:1,delay:.5,ease:"Cubic.easeIn",onComplete:function(){}})}})}function smoothValue(e,t,a){return a*e+(1-a)*t}function showAd(e){window.PokiSDK.commercialBreak((function(){muted||(Howler.mute(!0),music.pause())})).then((function(){console.log("Commercial break finished, proceeding to game"),muted||(Howler.mute(!1),playMusic()),e()}))}function showRewardAd(){window.PokiSDK.rewardedBreak((function(){muted||(Howler.mute(!0),music.pause())})).then((function(e){muted||(Howler.mute(!1),playMusic()),rewardAdSuccess(e),console.log("Rewarded break finished, proceeding to game")}))}function rewardAdSuccess(e){if(e){setTimeout((function(){playSound("upgradeReward",1)}),500);for(var t=0;t<aUpgradeOffer.length;t++)4!=aUpgradeOffer[t]&&saveDataHandler["addUpgrade"+aUpgradeOffer[t]]()}initNextP1Level()}function updateActionUpdate(){delta=runner.delta/1e3;for(var e=0;e<aEnemies.length;e++)aEnemies[e].update(),aEnemies[e].removeMe&&(aEnemies.splice(e,1),e-=1);for(e=0;e<aUsers.length;e++)aUsers[e].update(),aUsers[e].removeMe&&(aUsers.splice(e,1),e-=1)}function updateActionRender(){if(background.render(),"start"==gameState)cameraScale-=.05*(cameraScale-(maxCameraScale-0)),cameraX=canvas.width/2-(user.x+200*Math.sin(.03*panel.incY))*cameraScale+screenX,cameraY=canvas.height/2-(user.y-200*Math.sin(.04*panel.incY))*cameraScale+screenY;else if("game"==gameState)if(0==gameMode)0==user.state?(cameraScale-=.05*(cameraScale-(maxCameraScale-Math.min(.01*Matter.Body.getSpeed(user.body),.5))),cameraX-=.5*(cameraX-(canvas.width/2-user.x*cameraScale+screenX)),cameraY-=.5*(cameraY-(canvas.height/2-user.y*cameraScale+screenY))):cameraScale-=.05*(cameraScale-(maxCameraScale-0));else{var e=Math.max(Math.abs(user.x-enemy.x)/canvas.width,Math.abs(user.y-enemy.y)/canvas.height);cameraScale=Math.max(1.5-.6*e,.45),cameraX-=.5*(cameraX-(canvas.width/2-(user.x-(user.x-enemy.x)/2)*cameraScale+screenX)),cameraY-=.5*(cameraY-(canvas.height/2-(user.y-(user.y-enemy.y)/2)*cameraScale+screenY))}scene.update(),scene.render();for(var t=0;t<aUnderEffects.length;t++)aUnderEffects[t].update(),aUnderEffects[t].render(),aUnderEffects[t].removeMe&&(aUnderEffects.splice(t,1),t-=1);for(t=0;t<aEnemies.length;t++)aEnemies[t].render(),aEnemies[t].removeMe&&(aEnemies.splice(t,1),t-=1);for(t=0;t<aUsers.length;t++)aUsers[t].render(),aUsers[t].removeMe&&(aUsers.splice(t,1),t-=1);for(t=0;t<aPickUps.length;t++)aPickUps[t].update(),aPickUps[t].render(),aPickUps[t].removeMe&&(aPickUps.splice(t,1),t-=1);for(t=0;t<aOverEffects.length;t++)aOverEffects[t].update(),aOverEffects[t].render(),aOverEffects[t].removeMe&&(aOverEffects.splice(t,1),t-=1);panel.update(),panel.render(),checkButtonsOver()}function updateGameEvent(){"game"==gameState&&requestAnimFrame(updateGameEvent)}function updateCreditsScreenEvent(){"credits"==gameState&&(delta=getDelta(),background.render(),panel.update(),panel.render(),checkButtonsOver(),requestAnimFrame(updateCreditsScreenEvent))}function updateResetConfirmEvent(){"resetConfirm"==gameState&&(delta=getDelta(),background.render(),panel.update(),panel.render(),checkButtonsOver(),requestAnimFrame(updateResetConfirmEvent))}function updateSplashScreenEvent(){if("splash"==gameState){if(delta=getDelta(),(splashTimer+=delta)>2.5)return 1!=audioType||muted||(playMusic(),hasFocus||music.pause()),void initStartScreen();background.render(),panel.update(),panel.render(),checkButtonsOver(),requestAnimFrame(updateSplashScreenEvent)}}function updateLevelFailEvent(){if("levelFail"==gameState){delta=getDelta(),background.render(),cameraScale=1,cameraX=0,cameraY=0;for(var e=0;e<aUnderEffects.length;e++)aUnderEffects[e].update(),aUnderEffects[e].render(),aUnderEffects[e].removeMe&&(aUnderEffects.splice(e,1),e-=1);panel.update(),panel.render(),checkButtonsOver(),requestAnimFrame(updateLevelFailEvent)}}function updateLevelSuccessEvent(){if("levelSuccess"==gameState){delta=getDelta(),background.render(),cameraScale=1,cameraX=0,cameraY=0,panel.update(),panel.render();for(var e=0;e<aUnderEffects.length;e++)aUnderEffects[e].update(),aUnderEffects[e].render(),aUnderEffects[e].removeMe&&(aUnderEffects.splice(e,1),e-=1);checkButtonsOver(),requestAnimFrame(updateLevelSuccessEvent)}}function updateUpgradeScreenEvent(){if("upgradeScreen"==gameState){delta=getDelta(),background.render(),cameraScale=1,cameraX=0,cameraY=0,panel.update(),panel.render();for(var e=0;e<aUnderEffects.length;e++)aUnderEffects[e].update(),aUnderEffects[e].render(),aUnderEffects[e].removeMe&&(aUnderEffects.splice(e,1),e-=1);checkButtonsOver(),requestAnimFrame(updateUpgradeScreenEvent)}}function updateMultiplayerLevelEndEvent(){if("multiplayerLevelEnd"==gameState){delta=getDelta(),background.render(),cameraScale=1,cameraX=0,cameraY=0,panel.update(),panel.render();for(var e=0;e<aUnderEffects.length;e++)aUnderEffects[e].update(),aUnderEffects[e].render(),aUnderEffects[e].removeMe&&(aUnderEffects.splice(e,1),e-=1);for(e=0;e<aOverEffects.length;e++)aOverEffects[e].update(),aOverEffects[e].render(),aOverEffects[e].removeMe&&(aOverEffects.splice(e,1),e-=1);checkButtonsOver(),requestAnimFrame(updateMultiplayerLevelEndEvent)}}function updateStartScreenEvent(){"start"==gameState&&(delta=getDelta(),updateActionRender(),requestAnimFrame(updateStartScreenEvent))}function updateLoaderEvent(){"loading"==gameState&&(delta=getDelta(),assetLib.render(),requestAnimFrame(updateLoaderEvent))}function updatePauseEvent(){"pause"==gameState&&(delta=getDelta(),background.render(),panel.update(),panel.render(),checkButtonsOver(),requestAnimFrame(updatePauseEvent))}function twoDigit(e){var t=e.toString();return t.length<2&&(t="0"+t),t}function sortBy(e,t,a){return void 0===a&&(a=!0),a?e.sort((function(e,a){return e[t]<a[t]?-1:e[t]>a[t]?1:0})):e.sort((function(e,a){return e[t]>a[t]?-1:e[t]<a[t]?1:0}))}function getSpriteData(e,t){return{img:e.img,bX:e.oData.oAtlasData[oImageIds[t]].x,bY:e.oData.oAtlasData[oImageIds[t]].y,bWidth:e.oData.oAtlasData[oImageIds[t]].width,bHeight:e.oData.oAtlasData[oImageIds[t]].height}}function getMultiLineTextByChars(e,t,a){for(var i=new Array,s=getText(e,a);s.length>t;){var r=s.substring(0,t).lastIndexOf(" ");-1==r?(i.push(s.substring(0,t)+"-"),s=s.substring(t+1)):(i.push(s.substring(0,r)),s=s.substring(r+1))}return i.push(s),i}function addDirectText(e,t,a,i,s,r,o,n){if(void 0===n&&(n="#202020"),ctx.fillStyle=n,ctx.textAlign=i,a<getDirectWidth(e,t,o)){for(t--;a<getDirectWidth(e,t,o);)t--}ctx.font=t+"px "+assetLib.textData.langText["font"+e][curLang],ctx.fillText(o,s,r)}function addText(e,t,a,i,s,r,o,n){void 0===n&&(n="#202020"),ctx.fillStyle=n,ctx.textAlign=i;var h=t;if(a<getTextWidth(e,t,o)){for(t--;a<getTextWidth(e,t,o);)t--}"ar"==curLang&&(r-=t/15),r-=10*(1-t/h),ctx.font=t+"px "+assetLib.textData.langText["font"+e][curLang],ctx.fillText(getText(o,e),s,r)}function getText(e,t){var a=assetLib.textData.langText[e][curLang];if("tr"==curLang){for(var i,s="",r=0;r<a.length;)i=a.charAt(r),"Bangers"==assetLib.textData.langText["font"+t][curLang]&&"i"==i&&(i=""),s+=i,r++;a=s}return a}function getTextWidth(e,t,a){return ctx.font=t+"px "+assetLib.textData.langText["font"+e][curLang],ctx.measureText(getText(a,e)).width}function getDirectWidth(e,t,a){return ctx.font=t+"px "+assetLib.textData.langText["font"+e][curLang],ctx.measureText(a).width}function getCorrectedTextWidth(e,t,a,i){if(a<getTextWidth(e,t,i)){for(t--;a<getTextWidth(e,t,i);)t--}return ctx.font=t+"px "+assetLib.textData.langText["font"+e][curLang],ctx.measureText(getText(i,e)).width}function checkButtonsOver(){if(!isMobile)for(var e=0;e<panel.aButs.length;e++)panel.aButs[e].isOver=!1,userInput.mouseX>panel.aButs[e].aOverData[0]&&userInput.mouseX<panel.aButs[e].aOverData[2]&&userInput.mouseY>panel.aButs[e].aOverData[1]&&userInput.mouseY<panel.aButs[e].aOverData[3]&&(panel.aButs[e].isOver=!0)}function clearButtonOvers(){userInput.mouseX=-100,userInput.mouseY=-100}function getDelta(){var e=(new Date).getTime(),t=(e-previousTime)/1e3;return previousTime=e,t>.5&&(t=0),t}function normalizeAngle(e){return((e+180)%360+360)%360-180}function normalizeAngleRadian(e){return((e+Math.PI)%(2*Math.PI)+2*Math.PI)%(2*Math.PI)-Math.PI}function checkCircleHit(e,t){return(e[0]-t[0])*(e[0]-t[0])+(e[1]-t[1])*(e[1]-t[1])<=(e[2]+t[2])*(e[2]+t[2])}function getScaleImageToMax(e,t){return e.isSpriteSheet?t[0]/e.oData.spriteWidth<t[1]/e.oData.spriteHeight?Math.min(t[0]/e.oData.spriteWidth,1):Math.min(t[1]/e.oData.spriteHeight,1):t[0]/e.img.width<t[1]/e.img.height?Math.min(t[0]/e.img.width,1):Math.min(t[1]/e.img.height,1)}function getCentreFromTopLeft(e,t,a){var i=new Array;return i.push(e[0]+t.oData.spriteWidth/2*a),i.push(e[1]+t.oData.spriteHeight/2*a),i}function loadPreAssets(){(preAssetLib=new Utils.AssetLoader(curLang,[{id:"loader",file:"images/loader.png"},{id:"loadSpinner",file:"images/loadSpinner.png"}],ctx,canvas.width,canvas.height,!1)).onReady(initLoadAssets)}function initLangSelect(){for(var e,t,a,i,s=0,r=0;r<aLangs.length&&(r+1)*(1*(e=preAssetLib.getData("lang"+aLangs[r])).img.width)+10*(r+2)<canvas.width;r++)s++;i=Math.ceil(aLangs.length/s);for(r=0;r<aLangs.length;r++){e=preAssetLib.getData("lang"+aLangs[r]),t=canvas.width/2-s/2*(1*e.img.width)-(s-1)/2*10,t+=r%s*(1*e.img.width+10),a=canvas.height/2-i/2*(1*e.img.height)-(i-1)/2*10,a+=Math.floor(r/s)%i*(1*e.img.height+10),ctx.drawImage(e.img,0,0,e.img.width,e.img.height,t,a,1*e.img.width,1*e.img.height);var o={oImgData:e,aPos:[t+1*e.img.width/2,a+1*e.img.height/2],scale:1,id:"none",noMove:!0};userInput.addHitArea("langSelect",butEventHandler,{lang:aLangs[r]},"image",o)}}function initLoadAssets(){loadAssets()}function loadAssets(){assetLib=new Utils.AssetLoader(curLang,[{id:"splashLogo",file:"images/splashLogo.png"},{id:"wind0",file:"images/wind0.png"},{id:"wind1",file:"images/wind1.png"},{id:"bg0",file:"images/bg0.jpg"},{id:"bg1",file:"images/bg1.jpg"},{id:"bg2",file:"images/bg2.jpg"},{id:"bg3",file:"images/bg3.jpg"},{id:"bg4",file:"images/bg4.jpg"},{id:"bg5",file:"images/bg5.jpg"},{id:"texture0",file:"images/texture0.jpg"},{id:"flare",file:"images/flare.png"},{id:"uiButs",file:"images/uiButs.png",oAtlasData:{id0:{x:839,y:226,width:225,height:224},id1:{x:839,y:452,width:225,height:224},id10:{x:306,y:269,width:304,height:267},id11:{x:0,y:0,width:304,height:267},id12:{x:306,y:1076,width:304,height:267},id13:{x:306,y:538,width:304,height:267},id14:{x:306,y:807,width:304,height:267},id15:{x:0,y:269,width:304,height:267},id16:{x:1012,y:1130,width:98,height:98},id17:{x:1012,y:1230,width:98,height:98},id18:{x:1066,y:1004,width:98,height:98},id19:{x:612,y:1230,width:98,height:98},id2:{x:839,y:678,width:225,height:224},id20:{x:912,y:1230,width:98,height:98},id21:{x:912,y:1130,width:98,height:98},id22:{x:812,y:1130,width:98,height:98},id23:{x:612,y:1130,width:98,height:98},id24:{x:612,y:678,width:225,height:224},id25:{x:612,y:452,width:225,height:224},id26:{x:612,y:0,width:225,height:224},id27:{x:839,y:0,width:225,height:224},id28:{x:1066,y:678,width:224,height:224},id29:{x:1066,y:452,width:224,height:224},id3:{x:1066,y:226,width:225,height:224},id30:{x:712,y:1130,width:98,height:98},id31:{x:712,y:1230,width:98,height:98},id32:{x:1066,y:904,width:98,height:98},id33:{x:812,y:1230,width:98,height:98},id34:{x:612,y:226,width:225,height:224},id35:{x:612,y:904,width:225,height:224},id4:{x:1066,y:0,width:225,height:224},id5:{x:839,y:904,width:225,height:224},id6:{x:0,y:538,width:304,height:267},id7:{x:0,y:807,width:304,height:267},id8:{x:0,y:1076,width:304,height:267},id9:{x:306,y:0,width:304,height:267}}},{id:"scenery",file:"images/scenery.png",oAtlasData:{id0:{x:537,y:0,width:75,height:141},id1:{x:485,y:503,width:98,height:132},id10:{x:0,y:559,width:111,height:70},id11:{x:0,y:451,width:133,height:106},id12:{x:263,y:451,width:118,height:101},id13:{x:172,y:87,width:108,height:94},id14:{x:135,y:451,width:126,height:113},id15:{x:0,y:227,width:145,height:221},id16:{x:0,y:0,width:170,height:225},id17:{x:383,y:265,width:112,height:236},id18:{x:147,y:227,width:139,height:222},id19:{x:288,y:0,width:139,height:263},id2:{x:288,y:265,width:84,height:135},id3:{x:383,y:503,width:100,height:134},id4:{x:429,y:0,width:106,height:137},id5:{x:497,y:219,width:77,height:143},id6:{x:172,y:0,width:112,height:85},id7:{x:429,y:139,width:99,height:78},id8:{x:263,y:554,width:103,height:73},id9:{x:113,y:566,width:110,height:68}}},{id:"gameElements",file:"images/gameElements.png",oAtlasData:{id0:{x:916,y:621,width:101,height:101},id1:{x:827,y:114,width:101,height:101},id10:{x:338,y:612,width:224,height:108},id100:{x:0,y:722,width:254,height:259},id11:{x:612,y:114,width:213,height:118},id12:{x:566,y:545,width:217,height:112},id13:{x:386,y:108,width:224,height:106},id14:{x:0,y:983,width:233,height:106},id15:{x:708,y:659,width:206,height:118},id16:{x:235,y:983,width:232,height:122},id17:{x:469,y:1058,width:219,height:112},id18:{x:256,y:722,width:230,height:109},id19:{x:338,y:384,width:226,height:112},id2:{x:831,y:0,width:101,height:101},id20:{x:905,y:985,width:82,height:48},id21:{x:386,y:326,width:82,height:48},id22:{x:810,y:1181,width:82,height:48},id23:{x:470,y:326,width:82,height:48},id24:{x:1085,y:1163,width:78,height:48},id25:{x:928,y:827,width:78,height:48},id26:{x:824,y:882,width:78,height:48},id27:{x:1008,y:916,width:78,height:61},id28:{x:1084,y:403,width:78,height:61},id29:{x:1084,y:466,width:78,height:61},id3:{x:898,y:1061,width:101,height:101},id30:{x:1225,y:0,width:25,height:193},id31:{x:1150,y:195,width:39,height:193},id32:{x:1173,y:390,width:37,height:194},id33:{x:1206,y:977,width:26,height:193},id34:{x:1223,y:195,width:25,height:193},id35:{x:1234,y:975,width:24,height:193},id36:{x:1145,y:774,width:41,height:193},id37:{x:1191,y:195,width:30,height:193},id38:{x:1212,y:390,width:26,height:193},id39:{x:1090,y:916,width:53,height:193},id4:{x:890,y:415,width:101,height:101},id40:{x:0,y:1199,width:98,height:62},id41:{x:1001,y:985,width:87,height:87},id42:{x:1067,y:177,width:81,height:90},id43:{x:966,y:311,width:89,height:92},id44:{x:703,y:1181,width:105,height:75},id45:{x:934,y:0,width:94,height:96},id46:{x:1031,y:672,width:85,height:88},id47:{x:1019,y:585,width:85,height:85},id48:{x:930,y:103,width:99,height:102},id49:{x:993,y:499,width:89,height:84},id5:{x:890,y:518,width:101,height:101},id50:{x:824,y:779,width:102,height:101},id51:{x:1188,y:586,width:37,height:194},id52:{x:1165,y:969,width:39,height:193},id53:{x:1188,y:586,width:37,height:194},id54:{x:1206,y:782,width:26,height:193},id55:{x:1227,y:585,width:25,height:193},id56:{x:1234,y:780,width:24,height:193},id57:{x:1150,y:0,width:41,height:193},id58:{x:1193,y:0,width:30,height:193},id59:{x:1206,y:782,width:26,height:193},id6:{x:905,y:882,width:101,height:101},id60:{x:1118,y:579,width:53,height:193},id61:{x:100,y:1199,width:98,height:62},id62:{x:1001,y:1074,width:87,height:87},id63:{x:1057,y:311,width:81,height:90},id64:{x:993,y:405,width:89,height:92},id65:{x:596,y:1181,width:105,height:75},id66:{x:898,y:1164,width:94,height:96},id67:{x:1031,y:87,width:85,height:88},id68:{x:1030,y:0,width:85,height:85},id69:{x:966,y:207,width:99,height:102},id7:{x:928,y:724,width:101,height:101},id70:{x:994,y:1164,width:89,height:84},id71:{x:386,y:216,width:224,height:108},id72:{x:690,y:941,width:213,height:118},id73:{x:612,y:0,width:217,height:112},id74:{x:386,y:0,width:224,height:106},id75:{x:0,y:1091,width:233,height:106},id76:{x:690,y:1061,width:206,height:118},id77:{x:235,y:1107,width:232,height:122},id78:{x:469,y:944,width:219,height:112},id79:{x:256,y:833,width:230,height:109},id8:{x:785,y:520,width:103,height:103},id80:{x:338,y:498,width:226,height:112},id81:{x:564,y:659,width:82,height:48},id82:{x:564,y:659,width:82,height:48},id83:{x:564,y:659,width:82,height:48},id84:{x:564,y:659,width:82,height:48},id85:{x:1084,y:529,width:78,height:48},id86:{x:1084,y:529,width:78,height:48},id87:{x:1084,y:529,width:78,height:48},id88:{x:1031,y:762,width:78,height:61},id89:{x:1031,y:762,width:78,height:61},id9:{x:785,y:415,width:103,height:103},id90:{x:1031,y:762,width:78,height:61},id91:{x:612,y:234,width:125,height:86},id92:{x:469,y:1172,width:125,height:86},id93:{x:708,y:779,width:114,height:114},id94:{x:1008,y:827,width:87,height:87},id95:{x:566,y:326,width:217,height:217},id96:{x:488,y:722,width:218,height:217},id97:{x:785,y:234,width:179,height:179},id98:{x:0,y:0,width:384,height:382},id99:{x:0,y:384,width:336,height:336}}},{id:"uiElements",file:"images/uiElements.png",oAtlasData:{id0:{x:871,y:1480,width:191,height:190},id1:{x:1064,y:1480,width:191,height:190},id10:{x:1075,y:780,width:49,height:50},id11:{x:1109,y:832,width:49,height:50},id12:{x:1130,y:206,width:47,height:71},id13:{x:1341,y:412,width:160,height:249},id14:{x:707,y:853,width:83,height:49},id15:{x:707,y:574,width:315,height:204},id16:{x:1277,y:206,width:315,height:204},id17:{x:707,y:368,width:568,height:204},id18:{x:0,y:1466,width:568,height:204},id19:{x:706,y:917,width:599,height:561},id2:{x:1307,y:1192,width:189,height:190},id20:{x:1130,y:0,width:315,height:204},id21:{x:1024,y:574,width:315,height:204},id22:{x:1307,y:986,width:315,height:204},id23:{x:1307,y:780,width:315,height:204},id24:{x:0,y:917,width:704,height:547},id25:{x:0,y:368,width:705,height:547},id26:{x:1006,y:849,width:50,height:50},id27:{x:707,y:780,width:213,height:71},id28:{x:586,y:1626,width:14,height:35},id29:{x:570,y:1626,width:14,height:35},id3:{x:1257,y:1480,width:189,height:190},id30:{x:0,y:184,width:777,height:182},id31:{x:1006,y:780,width:67,height:67},id32:{x:0,y:0,width:777,height:182},id33:{x:1130,y:279,width:47,height:71},id34:{x:922,y:780,width:82,height:84},id35:{x:779,y:0,width:349,height:359},id4:{x:792,y:853,width:55,height:55},id5:{x:570,y:1553,width:299,height:71},id6:{x:570,y:1480,width:299,height:71},id7:{x:849,y:853,width:50,height:50},id8:{x:1058,y:849,width:49,height:50},id9:{x:1126,y:780,width:49,height:50}}},{id:"langText",file:"json/text.json"}],ctx,canvas.width,canvas.height),oImageIds.playBut=getAssetId(!0),oImageIds.playButOver=getAssetId(),oImageIds.p1But=getAssetId(),oImageIds.p1ButOver=getAssetId(),oImageIds.p2But=getAssetId(),oImageIds.p2ButOver=getAssetId(),oImageIds.upgradeBut0=getAssetId(),oImageIds.upgradeBut0Over=getAssetId(),oImageIds.upgradeBut1=getAssetId(),oImageIds.upgradeBut1Over=getAssetId(),oImageIds.upgradeBut2=getAssetId(),oImageIds.upgradeBut2Over=getAssetId(),oImageIds.upgradeBut3=getAssetId(),oImageIds.upgradeBut3Over=getAssetId(),oImageIds.upgradeBut4=getAssetId(),oImageIds.upgradeBut4Over=getAssetId(),oImageIds.infoBut=getAssetId(),oImageIds.infoButOver=getAssetId(),oImageIds.muteBut1=getAssetId(),oImageIds.muteBut1Over=getAssetId(),oImageIds.muteBut0=getAssetId(),oImageIds.muteBut0Over=getAssetId(),oImageIds.pauseBut=getAssetId(),oImageIds.pauseButOver=getAssetId(),oImageIds.quitBut=getAssetId(),oImageIds.quitButOver=getAssetId(),oImageIds.continueBut=getAssetId(),oImageIds.continueButOver=getAssetId(),oImageIds.replayBut=getAssetId(),oImageIds.replayButOver=getAssetId(),oImageIds.resetBut=getAssetId(),oImageIds.resetButOver=getAssetId(),oImageIds.backBut=getAssetId(),oImageIds.backButOver=getAssetId(),oImageIds.yesBut=getAssetId(),oImageIds.yesButOver=getAssetId(),oImageIds.scenery0=getAssetId(!0),oImageIds.scenery1=getAssetId(),oImageIds.scenery2=getAssetId(),oImageIds.scenery3=getAssetId(),oImageIds.scenery4=getAssetId(),oImageIds.scenery5=getAssetId(),oImageIds.scenery6=getAssetId(),oImageIds.scenery7=getAssetId(),oImageIds.scenery8=getAssetId(),oImageIds.scenery9=getAssetId(),oImageIds.scenery10=getAssetId(),oImageIds.scenery11=getAssetId(),oImageIds.scenery12=getAssetId(),oImageIds.scenery13=getAssetId(),oImageIds.scenery14=getAssetId(),oImageIds.scenery15=getAssetId(),oImageIds.scenery16=getAssetId(),oImageIds.scenery17=getAssetId(),oImageIds.scenery18=getAssetId(),oImageIds.scenery19=getAssetId(),oImageIds.wheel0=getAssetId(!0),oImageIds.wheel1=getAssetId(),oImageIds.wheel2=getAssetId(),oImageIds.wheel3=getAssetId(),oImageIds.wheel4=getAssetId(),oImageIds.wheel5=getAssetId(),oImageIds.wheel6=getAssetId(),oImageIds.wheel7=getAssetId(),oImageIds.wheel8=getAssetId(),oImageIds.wheel9=getAssetId(),oImageIds.body0=getAssetId(),oImageIds.body1=getAssetId(),oImageIds.body2=getAssetId(),oImageIds.body3=getAssetId(),oImageIds.body4=getAssetId(),oImageIds.body5=getAssetId(),oImageIds.body6=getAssetId(),oImageIds.body7=getAssetId(),oImageIds.body8=getAssetId(),oImageIds.body9=getAssetId(),oImageIds.chassis0=getAssetId(),oImageIds.chassis1=getAssetId(),oImageIds.chassis2=getAssetId(),oImageIds.chassis3=getAssetId(),oImageIds.chassis4=getAssetId(),oImageIds.chassis5=getAssetId(),oImageIds.chassis6=getAssetId(),oImageIds.chassis7=getAssetId(),oImageIds.chassis8=getAssetId(),oImageIds.chassis9=getAssetId(),oImageIds.arm0=getAssetId(),oImageIds.arm1=getAssetId(),oImageIds.arm2=getAssetId(),oImageIds.arm3=getAssetId(),oImageIds.arm4=getAssetId(),oImageIds.arm5=getAssetId(),oImageIds.arm6=getAssetId(),oImageIds.arm7=getAssetId(),oImageIds.arm8=getAssetId(),oImageIds.arm9=getAssetId(),oImageIds.mace0=getAssetId(),oImageIds.mace1=getAssetId(),oImageIds.mace2=getAssetId(),oImageIds.mace3=getAssetId(),oImageIds.mace4=getAssetId(),oImageIds.mace5=getAssetId(),oImageIds.mace6=getAssetId(),oImageIds.mace7=getAssetId(),oImageIds.mace8=getAssetId(),oImageIds.mace9=getAssetId(),oImageIds.wheel0Hit=oImageIds.wheel1Hit=oImageIds.wheel2Hit=oImageIds.wheel3Hit=oImageIds.wheel4Hit=oImageIds.wheel5Hit=oImageIds.wheel6Hit=oImageIds.wheel7Hit=oImageIds.wheel8Hit=oImageIds.wheel9Hit=getAssetId(),oImageIds.arm0Hit=getAssetId(),oImageIds.arm1Hit=getAssetId(),oImageIds.arm2Hit=getAssetId(),oImageIds.arm3Hit=getAssetId(),oImageIds.arm4Hit=getAssetId(),oImageIds.arm5Hit=getAssetId(),oImageIds.arm6Hit=getAssetId(),oImageIds.arm7Hit=getAssetId(),oImageIds.arm8Hit=getAssetId(),oImageIds.arm9Hit=getAssetId(),oImageIds.mace0Hit=getAssetId(),oImageIds.mace1Hit=getAssetId(),oImageIds.mace2Hit=getAssetId(),oImageIds.mace3Hit=getAssetId(),oImageIds.mace4Hit=getAssetId(),oImageIds.mace5Hit=getAssetId(),oImageIds.mace6Hit=getAssetId(),oImageIds.mace7Hit=getAssetId(),oImageIds.mace8Hit=getAssetId(),oImageIds.mace9Hit=getAssetId(),oImageIds.body0Hit=getAssetId(),oImageIds.body1Hit=getAssetId(),oImageIds.body2Hit=getAssetId(),oImageIds.body3Hit=getAssetId(),oImageIds.body4Hit=getAssetId(),oImageIds.body5Hit=getAssetId(),oImageIds.body6Hit=getAssetId(),oImageIds.body7Hit=getAssetId(),oImageIds.body8Hit=getAssetId(),oImageIds.body9Hit=getAssetId(),oImageIds.chassis0Hit=getAssetId(),oImageIds.chassis1Hit=getAssetId(),oImageIds.chassis2Hit=getAssetId(),oImageIds.chassis3Hit=getAssetId(),oImageIds.chassis4Hit=getAssetId(),oImageIds.chassis5Hit=getAssetId(),oImageIds.chassis6Hit=getAssetId(),oImageIds.chassis7Hit=getAssetId(),oImageIds.chassis8Hit=getAssetId(),oImageIds.chassis9Hit=getAssetId(),oImageIds.bomb0=getAssetId(),oImageIds.bomb1=getAssetId(),oImageIds.health=getAssetId(),oImageIds.cog=getAssetId(),oImageIds.beachBall0=getAssetId(),oImageIds.beachBall1=getAssetId(),oImageIds.sawBlade=getAssetId(),oImageIds.rock=getAssetId(),oImageIds.exitPortal0=getAssetId(),oImageIds.exitPortal1=getAssetId(),oImageIds.leftTouch=getAssetId(!0),oImageIds.rightTouch=getAssetId(),oImageIds.jumpTouch=getAssetId(),oImageIds.swingTouch=getAssetId(),oImageIds.coinSmall=getAssetId(),oImageIds.scoreBar1=getAssetId(),oImageIds.scoreBar0=getAssetId(),oImageIds.cupSmall=getAssetId(),oImageIds.marker10=getAssetId(),oImageIds.marker11=getAssetId(),oImageIds.marker00=getAssetId(),oImageIds.marker01=getAssetId(),oImageIds.distMarker=getAssetId(),oImageIds.finger=getAssetId(),oImageIds.truckMarker=getAssetId(),oImageIds.tut00=getAssetId(),oImageIds.tut01=getAssetId(),oImageIds.tut10=getAssetId(),oImageIds.tut11=getAssetId(),oImageIds.logo=getAssetId(),oImageIds.tut20=getAssetId(),oImageIds.tut21=getAssetId(),oImageIds.tut30=getAssetId(),oImageIds.tut31=getAssetId(),oImageIds.levelShield0=getAssetId(),oImageIds.levelShield1=getAssetId(),oImageIds.cogSmall=getAssetId(),oImageIds.scoreBar2=getAssetId(),oImageIds.upgradePip0=getAssetId(),oImageIds.upgradePip1=getAssetId(),oImageIds.upgradeBar0=getAssetId(),oImageIds.upgradeCog=getAssetId(),oImageIds.upgradeBar1=getAssetId(),oImageIds.exitDistMarker=getAssetId(),oImageIds.exitMarker=getAssetId(),oImageIds.rotateMessage=getAssetId(),assetLib.onReady(initSplash),gameState="loading",previousTime=(new Date).getTime(),updateLoaderEvent()}function getAssetId(e){return void 0===e&&(e=!1),e&&(assetIdInc=0),"id"+assetIdInc++}function resizeCanvas(){var e,t,a,i=window.innerWidth,s=window.innerHeight;if(canvas.height=s,canvas.width=i,canvas.style.width=i+"px",canvas.style.height=s+"px",canvasScale=1,i<s?(e=maxWidth,t=minWidth,a=minHeight):(e=maxHeight,t=minHeight,a=minWidth),canvas.width/canvas.height<t/a?(canvas.width=e,canvas.height=e*(s/i),canvasScale=e/i):(canvas.height=a,canvas.width=a*(i/s),canvasScale=a/s),"game"===gameState)isMobile&&(removeMobileControls(),addMobileControls());this.prevCanvasWidth=i,this.prevCanvasHeight=s,window.scrollTo(0,0)}function playSound(e,t){if(void 0===t&&(t=1),1==audioType){var a=sound.play(e);sound.volume(t,a)}}function loopSound(e,t){void 0===t&&(t=1),1==audioType&&(sound.loop(!0,e),curSoundLoop=sound.play(e),sound.loop(!0,curSoundLoop),sound.volume(t,curSoundLoop))}function stopLoopSound(){sound.stop(curSoundLoop)}function toggleMute(){muted=!muted,1==audioType?muted?(Howler.mute(!0),music.pause()):(Howler.mute(!1),playMusic(),"game"==gameState?music.volume(.25):music.volume(.1)):2==audioType&&(muted?music.pause():playMusic())}Matter.Events.on(engine,"afterUpdate",checkCollisions),Matter.Events.on(engine,"beforeUpdate",(function(){for(var e=0;e<_this_1.aUsers.length;e++)limitMaxSpeedBody(_this_1.aUsers[e].body);for(e=0;e<_this_1.aUsers.length;e++)limitMaxSpeedBody(_this_1.aEnemies[e].body);updateActionUpdate()}));